<!DOCTYPE html>


<html lang="Chinese">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Frank’s blogs</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/FLogo.png" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/bkgPic.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Frank’s blogs</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['包含但不限于Linux编程', '算法题总结', 'C/C++/python等开发'],
        startDelay: 0,
        typeSpeed: 100,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  
<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content">包含但不限于Linux编程、C/C++开发、算法题等等。</div>
</div>


<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Linux初步学习（一）"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/01/02/Linux%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/"
    >Linux初步学习（一）</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/01/02/Linux%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2022-01-02T03:36:20.000Z" itemprop="datePublished">2022-01-02</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Linux初步学习（一）"><a href="#Linux初步学习（一）" class="headerlink" title="Linux初步学习（一）"></a>Linux初步学习（一）</h1><p><strong>菜鸟教程入口：</strong><br><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-tutorial.html">https://www.runoob.com/linux/linux-tutorial.html</a></p>
<h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-shell-variable.html">https://www.runoob.com/linux/linux-shell-variable.html</a></p>
<ul>
<li><p>Shell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。Shell 既是一种命令语言，又是一种程序设计语言。</p>
</li>
<li><p>Shell 是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问操作系统内核的服务。</p>
</li>
<li><p>Ken Thompson 的 sh 是第一种 Unix Shell，Windows Explorer 是一个典型的图形界面 Shell。</p>
</li>
</ul>
<h3 id="shell脚本的扩展名为-sh"><a href="#shell脚本的扩展名为-sh" class="headerlink" title="shell脚本的扩展名为.sh"></a>shell脚本的扩展名为.sh</h3><ul>
<li>指定shell 解释器</li>
</ul>
<p>​        <code>#!/bin/bash</code></p>
<p>​        <code>#!</code>符号后面指定</p>
<ul>
<li><p>运行脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod +x ./test.sh  #使脚本具有执行权限</span><br><span class="line">./test.sh  #执行脚本</span><br></pre></td></tr></table></figure></li>
<li><p>注意此处运行的时候<strong>必须写成</strong><code>./</code>文件名的形式，<strong>直接写</strong>的话<strong>Linux会去Path里面</strong>寻找这个文件，而只有 /bin, /sbin, /usr/bin，/usr/sbin 等在 PATH 里，你的当前目录通常不在 PATH 里，所以写成 test.sh 是会找不到命令的，要用 <code>./test.sh </code>告诉系统说，就在当前目录找。</p>
</li>
<li><p>或者作为解释器参数传给解释器以进行运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/sh test.sh</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="第一个shell程序"><a href="#第一个shell程序" class="headerlink" title="第一个shell程序"></a>第一个shell程序</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo &quot;Hello World !&quot;</span><br></pre></td></tr></table></figure>

<p><code>echo</code>是控制台输出</p>
<p><img src="/imgs/image-20220102115757607.png" alt="image-20220102115757607"></p>
<h3 id="shell-变量"><a href="#shell-变量" class="headerlink" title="shell 变量"></a>shell 变量</h3><ul>
<li><p>变量名不能有<code>$</code></p>
</li>
<li><p>命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。</p>
</li>
<li><p>中间不能有空格，可以使用下划线 **_**。</p>
</li>
<li><p>不能使用标点符号。</p>
</li>
<li><p>不能使用bash里的关键字（可用help命令查看保留关键字）。</p>
</li>
</ul>
<h3 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h3><p>显式<code>=</code>，或者</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for file in `ls /etc`</span><br><span class="line">或者</span><br><span class="line">for file in $(ls /etc)</span><br></pre></td></tr></table></figure>

<p>以上语句将 /etc 下目录的文件名循环出来。</p>
<h3 id="变量使用"><a href="#变量使用" class="headerlink" title="变量使用"></a>变量使用</h3><ul>
<li>使用一个定义过的变量，只要在变量名前面加美元符号即可</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name=&quot;qinjx&quot;</span><br><span class="line">echo $your_name</span><br><span class="line">echo $&#123;your_name&#125;</span><br></pre></td></tr></table></figure>

<p>花括号的作用是提示编译器这是个变量名</p>
<p>比如</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for skill in Ada Coffe Action Java; do</span><br><span class="line">    echo &quot;I am good at $&#123;skill&#125;Script&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>如果不给skill变量加花括号，写成echo “I am good at $skillScript”，解释器就会把$skillScript当成一个变量（其值为空），代码执行结果就不是我们期望的样子了。</p>
<ul>
<li><p>加上：<img src="/imgs/image-20220102121030726.png" alt="image-20220102121030726"></p>
</li>
<li><p>不加但是加了空格：</p>
</li>
<li><p><img src="/imgs/image-20220102121227839.png" alt="image-20220102121227839"></p>
</li>
</ul>
<p><strong>花括号加不加都行，不加的时候注意用空格区分开</strong></p>
<h3 id="变量只读"><a href="#变量只读" class="headerlink" title="变量只读"></a>变量只读</h3><ul>
<li>使用 readonly 命令可以将变量定义为只读变量，只读变量的值不能被改变。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">myUrl=&quot;https://www.google.com&quot;</span><br><span class="line">readonly myUrl</span><br><span class="line">myUrl=&quot;https://www.runoob.com&quot;</span><br></pre></td></tr></table></figure>

<h3 id="变量删除"><a href="#变量删除" class="headerlink" title="变量删除"></a>变量删除</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unset variable_name</span><br></pre></td></tr></table></figure>

<h3 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h3><ul>
<li><strong>1) 局部变量</strong> 局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。</li>
<li><strong>2) 环境变量</strong> 所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量。</li>
<li><strong>3) shell变量</strong> shell变量是由shell程序设置的特殊变量。shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行</li>
</ul>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p><strong>单引号</strong></p>
<ul>
<li>单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；</li>
<li>单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行），但可成对出现，作为字符串拼接使用。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">str=&#x27;this is a string&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>双引号</strong></p>
<ul>
<li>双引号里可以有变量</li>
<li>双引号里可以出现转义字符</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">your_name=<span class="string">&quot;runoob&quot;</span></span><br><span class="line">str=<span class="string">&quot;Hello, I know you are \&quot;<span class="variable">$your_name</span>\&quot;! \n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$str</span></span><br></pre></td></tr></table></figure>

<p><strong>字符串拼接</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name=&quot;runoob&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用双引号拼接</span></span><br><span class="line">greeting=&quot;hello, &quot;$your_name&quot; !&quot;</span><br><span class="line">greeting_1=&quot;hello, $&#123;your_name&#125; !&quot;</span><br><span class="line">echo $greeting  $greeting_1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用单引号拼接</span></span><br><span class="line">greeting_2=&#x27;hello, &#x27;$your_name&#x27; !&#x27;</span><br><span class="line">greeting_3=&#x27;hello, $&#123;your_name&#125; !&#x27;</span><br><span class="line">echo $greeting_2  $greeting_3</span><br></pre></td></tr></table></figure>

<ul>
<li>直接拼接，不需要逗号或者加号等</li>
</ul>
<p><strong>子字符串</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">string=&quot;runoob is a great site&quot;</span><br><span class="line">echo $&#123;string:1:4&#125; # 输出 unoo</span><br></pre></td></tr></table></figure>

<p><strong>查找字符串</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">string=<span class="string">&quot;runoob is a great site&quot;</span></span><br><span class="line"><span class="built_in">echo</span> `expr index <span class="string">&quot;<span class="variable">$string</span>&quot;</span> io`  <span class="comment"># 输出 4</span></span><br></pre></td></tr></table></figure>

<ul>
<li>注意上面的expr…是反引号，不是单引号</li>
</ul>
<p><strong>字符串长度</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">string=<span class="string">&quot;abcd&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#string&#125;</span> <span class="comment">#输出 4</span></span><br></pre></td></tr></table></figure>

<p><strong>字符串长度的其他方法</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">string=<span class="string">&quot;hello,everyone my name is xiaoming&quot;</span></span><br><span class="line">expr length <span class="string">&quot;<span class="variable">$string</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/imgs/image-20220102142331661.png" alt="image-20220102142331661"></p>
<p>输出6</p>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">数组名=(值1 值2 ... 值n)</span><br><span class="line">array_name=(value0 value1 value2 value3)</span><br><span class="line">array_name=(</span><br><span class="line">value0</span><br><span class="line">value1</span><br><span class="line">value2</span><br><span class="line">value3</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>单独定义变量</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">array_name[0]=value0</span><br><span class="line">array_name[1]=value1</span><br><span class="line">array_name[n]=valuen</span><br></pre></td></tr></table></figure>

<p><strong>读数组内容</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$&#123;数组名[下标]&#125;</span></span><br><span class="line">valuen=<span class="variable">$&#123;array_name[n]&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>取得数组全部内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $&#123;array_name[@]&#125;</span><br></pre></td></tr></table></figure>

<p><strong>取得数组长度</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 取得数组元素的个数</span></span><br><span class="line">length=<span class="variable">$&#123;#array_name[@]&#125;</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">length=<span class="variable">$&#123;#array_name[*]&#125;</span></span><br><span class="line"><span class="comment"># 取得数组单个元素的长度</span></span><br><span class="line">lengthn=<span class="variable">$&#123;#array_name[n]&#125;</span></span><br></pre></td></tr></table></figure>

<p>注意，可能数组会出现<img src="/imgs/image-20220102141720725.png" alt="image-20220102141720725">这是因为 ubuntu 模式使用的是 dash 模式，如果<strong>不想报错使用 bash 模式</strong></p>
<p>的报错，此时使用命令 <code>bash xxx.sh</code>  或者 将脚本第一行改为 <code>*#!/bin/bash</code>，执行<code>./example.sh</code>也可以</p>
<p>输出数组长度的时候可能<strong>不对</strong>，此时输出的是1</p>
<p><img src="/imgs/image-20220102142013809.png" alt="image-20220102142013809"></p>
<p>此时也是1</p>
<p><img src="/imgs/image-20220102142050921.png" alt="image-20220102142050921"></p>
<p>此代码的输出为</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">array=(0,1,2,3,4,5,6)</span><br><span class="line">echo $&#123;#array[@]&#125;</span><br><span class="line">echo $array</span><br><span class="line">echo $&#123;array[*]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/imgs/image-20220102142905800.png" alt="image-20220102142905800"></p>
<ul>
<li>可以通过给数组设置<strong>下标范围以外</strong>的单元的内容来增加数组的长度</li>
</ul>
<h4 id="注意，使用指定下标修改数组比如array-name-0-value0会丢弃该下标后面的其他内容"><a href="#注意，使用指定下标修改数组比如array-name-0-value0会丢弃该下标后面的其他内容" class="headerlink" title="注意，使用指定下标修改数组比如array_name[0]=value0会丢弃该下标后面的其他内容"></a>注意，使用指定下标修改数组比如<code>array_name[0]=value0</code>会丢弃该下标后面的其他内容</h4><h3 id="注意，代码不能随意包含空格，比如等号两边，可能会引起错误"><a href="#注意，代码不能随意包含空格，比如等号两边，可能会引起错误" class="headerlink" title="注意，代码不能随意包含空格，比如等号两边，可能会引起错误"></a>注意，代码不能随意包含空格，比如等号两边，可能会引起错误</h3><h4 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h4><p>参考 <a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-shell-variable.html">https://www.runoob.com/linux/linux-shell-variable.html</a> 第一篇笔记</p>
<h3 id="读取用户输入"><a href="#读取用户输入" class="headerlink" title="读取用户输入"></a>读取用户输入</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">read</span> [-options] [variable...]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">read -p &quot;input a val:&quot; a    #获取键盘输入的 a 变量数字</span><br><span class="line">read -p &quot;input b val:&quot; b    #获取键盘输入的 b 变量数字</span><br><span class="line">r=$[a+b]                    #计算a+b的结果 赋值给r  不能有空格</span><br><span class="line">echo &quot;result = $&#123;r&#125;&quot;        #输出显示结果 r</span><br></pre></td></tr></table></figure>

<h3 id="shell注释"><a href="#shell注释" class="headerlink" title="shell注释"></a>shell注释</h3><p>以<code>#</code> 开头的行就是注释，会被解释器忽略。</p>
<ul>
<li>多行注释</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">:&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">注释内容...</span></span><br><span class="line"><span class="string">注释内容...</span></span><br><span class="line"><span class="string">注释内容...</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>或者任何符号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">:&lt;&lt;&#x27;</span><br><span class="line">注释内容...</span><br><span class="line">注释内容...</span><br><span class="line">注释内容...</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">:&lt;&lt;!</span><br><span class="line">注释内容...</span><br><span class="line">注释内容...</span><br><span class="line">注释内容...</span><br><span class="line">!</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-SolidWorks打不开UG导出的x-t文件解决方法"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/21/SolidWorks%E6%89%93%E4%B8%8D%E5%BC%80UG%E5%AF%BC%E5%87%BA%E7%9A%84x-t%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"
    >SolidWorks打不开UG导出的x_t文件解决方法</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/21/SolidWorks%E6%89%93%E4%B8%8D%E5%BC%80UG%E5%AF%BC%E5%87%BA%E7%9A%84x-t%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2021-12-21T08:34:45.000Z" itemprop="datePublished">2021-12-21</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="SolidWorks打不开UG导出的x-t-Parasolid-文件解决方法"><a href="#SolidWorks打不开UG导出的x-t-Parasolid-文件解决方法" class="headerlink" title="SolidWorks打不开UG导出的x_t(Parasolid)文件解决方法"></a>SolidWorks打不开UG导出的x_t(Parasolid)文件解决方法</h1><ul>
<li><p>更改设置</p>
</li>
<li><p><img src="/imgs/image-20211221163511577.png" alt="image-20211221163511577"></p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-freeRTOS中断"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/20/freeRTOS%E4%B8%AD%E6%96%AD/"
    >freeRTOS中断和信号量以及任务管理</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/20/freeRTOS%E4%B8%AD%E6%96%AD/" class="article-date">
  <time datetime="2021-12-20T14:10:33.000Z" itemprop="datePublished">2021-12-20</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="freeRTOS中断和信号量"><a href="#freeRTOS中断和信号量" class="headerlink" title="freeRTOS中断和信号量"></a>freeRTOS中断和信号量</h1><p>使用freeRTOS中断与使用正常的中断区别不大（不使用FreeRTOS自带的API），直接使用系统给的中断函数即可</p>
<ul>
<li><p>手动启动这两个</p>
</li>
<li><p><img src="/imgs/image-20211220221301553.png" alt="image-20211220221301553"></p>
</li>
<li><p>注意，使用EXTI的时候（外部中断），需要自己<strong>手动定义</strong>中断处理函数</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="keyword">uint16_t</span> GPIO_Pin)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>系统没有给出这个函数的定义，可以自己在任意文件中定义</p>
</li>
<li><p>设置的优先级比系统（RTOS）<strong>高</strong>的话，中断处理函数就<strong>不会被系统打断执行</strong>。</p>
</li>
<li><p>注意，在中断函数中调用FreeRTOS的API的时候，需要采用Fron_ISR的API。FreeRTOS对于一些系统API函数提供两种版本，一种是供<strong>任务调用</strong>的，一种是供<strong>中断调用的（Interrupt Safe API）</strong>。由中断调用的API函数后缀上会有“FromISR”。</p>
</li>
</ul>
<h2 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h2><ul>
<li><p>简单而言就是一个进程通过一个信号变量指示另一个线程是阻塞还是运行，详见<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/139469342">https://zhuanlan.zhihu.com/p/139469342</a></p>
</li>
<li><p>有两种调用方式，一种是使用CMSIS_OS中的<code>osSemaphoreId osSemaphoreCreate (const osSemaphoreDef_t *semaphore_def, int32_t count);</code>、<code>int32_t osSemaphoreWait (osSemaphoreId semaphore_id, uint32_t millisec);</code>和<code>osStatus osSemaphoreRelease (osSemaphoreId semaphore_id);</code>函数</p>
</li>
<li><p>或者是手动<code>#include &quot;semphr.h&quot;</code>，然后使用知乎网页上的<code>SemaphoreHandle_t xSemaphoreCreateBinary( void )</code>、<code>BaseType_t xSemaphoreTake( SemaphoreHandle_t xSemaphore, TickType_t xTicksToWait )</code>、<code>BaseType_t xSemaphoreGive( SemaphoreHandle_t xSemaphore );</code>以及中断函数中的<code>BaseType_t xSemaphoreGiveFromISR( SemaphoreHandle_t xSemaphore, BaseType_t *pxHigherPriorityTaskWoken )</code></p>
</li>
<li><p>注意，<code>xSemaphoreGiveFromISR</code>函数的第二个参数是可选的，不需要的时候可以给NULL，具体作用详见<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45045399/article/details/103238514">https://blog.csdn.net/weixin_45045399/article/details/103238514</a></p>
</li>
<li><p><strong>xTicksToWait</strong> 如果信号量不可用的话任务处于阻塞状态的<strong>最长时间</strong>，设置为 portMAX_DELAY的话任务会<strong>一直处于阻塞状态</strong>直到信号量可用，设置为0的话如果信号量不可用的话会<strong>直接返回</strong></p>
</li>
<li><p>假如准备在对应的中断中调用系统的API的话，注意<strong>勾选这个选项</strong>并且<strong>调整相应的中断优先级</strong>，<strong>否则会卡死</strong></p>
</li>
<li><p><img src="/imgs/image-20211220234334003.png" alt="image-20211220234334003"></p>
</li>
<li><p>经过测试，虽然<code>osSemaphoreId</code>与FreeRTOS原生的API要求的<code>SemaphoreHandle_t</code>不同，但是两种API<strong>都可以运行</strong>，直接替换即可。</p>
</li>
</ul>
<h2 id="优先级倒置"><a href="#优先级倒置" class="headerlink" title="优先级倒置"></a>优先级倒置</h2><p>参考知乎文章<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/139469342">https://zhuanlan.zhihu.com/p/139469342</a></p>
<h2 id="互斥量"><a href="#互斥量" class="headerlink" title="互斥量"></a>互斥量</h2><p>同上</p>
<h2 id="关键区"><a href="#关键区" class="headerlink" title="关键区"></a>关键区</h2><p>同上</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-使用CubeIDE配置JLink和项目"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/20/%E4%BD%BF%E7%94%A8CubeIDE%E9%85%8D%E7%BD%AEJLink%E5%92%8C%E9%A1%B9%E7%9B%AE/"
    >使用CubeIDE配置JLink和项目</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/20/%E4%BD%BF%E7%94%A8CubeIDE%E9%85%8D%E7%BD%AEJLink%E5%92%8C%E9%A1%B9%E7%9B%AE/" class="article-date">
  <time datetime="2021-12-20T12:59:09.000Z" itemprop="datePublished">2021-12-20</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="使用CubeIDE配置JLink和项目"><a href="#使用CubeIDE配置JLink和项目" class="headerlink" title="使用CubeIDE配置JLink和项目"></a>使用CubeIDE配置JLink和项目</h1><h2 id="配置Cube"><a href="#配置Cube" class="headerlink" title="配置Cube"></a>配置Cube</h2><ul>
<li><p><img src="/imgs/image-20211220210102796.png" alt="image-20211220210102796"></p>
</li>
<li><p>新建项目，然后在Cube中配置相关的内容</p>
</li>
<li><p>选择填写相关的信息，名称等</p>
</li>
<li><p><img src="/imgs/image-20211220210224776.png" alt="image-20211220210224776"></p>
</li>
<li><p>此处放大窗口</p>
</li>
<li><p><img src="/imgs/image-20211220211956239.png" alt="image-20211220211956239"></p>
</li>
<li><p>设置好之后，右键创建代码</p>
</li>
<li><p><img src="/imgs/image-20211220212713729.png" alt="image-20211220212713729"></p>
</li>
<li><p>假如此时不能点击<code>generate code</code>的话，右键选择<code>build project</code>然后在提示创建代码的时候选择ok，或者是点击cancel然后再次右键，可以看到<code>generate code</code>可以使用了</p>
</li>
</ul>
<h2 id="配置J-Link"><a href="#配置J-Link" class="headerlink" title="配置J-Link"></a>配置J-Link</h2><ul>
<li><p><img src="/imgs/image-20211220210941718.png" alt="image-20211220210941718"></p>
</li>
<li><p>然后点击这里</p>
</li>
<li><p><img src="/imgs/image-20211220213008029.png" alt="image-20211220213008029"></p>
</li>
<li><p>然后选择</p>
</li>
<li><p><img src="/imgs/image-20211220213904526.png" alt="image-20211220213904526"></p>
</li>
<li><p>此处选择</p>
</li>
<li><p><img src="/imgs/image-20211220215318321.png" alt="image-20211220215318321"></p>
</li>
<li><p>否则会说program file does not exist的错误</p>
</li>
<li><p>注意include 文件的时候需要包括上一级目录到系统的include路径下才行，比如</p>
</li>
<li><p><img src="/imgs/image-20211220215431799.png" alt="image-20211220215431799"></p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-使用freeRTOS的队列和定时器"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/18/%E4%BD%BF%E7%94%A8freeRTOS%E7%9A%84%E9%98%9F%E5%88%97%E5%92%8C%E5%AE%9A%E6%97%B6%E5%99%A8/"
    >使用freeRTOS的队列和定时器</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/18/%E4%BD%BF%E7%94%A8freeRTOS%E7%9A%84%E9%98%9F%E5%88%97%E5%92%8C%E5%AE%9A%E6%97%B6%E5%99%A8/" class="article-date">
  <time datetime="2021-12-18T04:59:35.000Z" itemprop="datePublished">2021-12-18</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="使用freeRTOS的队列和定时器"><a href="#使用freeRTOS的队列和定时器" class="headerlink" title="使用freeRTOS的队列和定时器"></a>使用freeRTOS的队列和定时器</h1><h2 id="Cube"><a href="#Cube" class="headerlink" title="Cube"></a>Cube</h2><ul>
<li>注意必须用<code>CMSIS_V2</code>系统才可以设置定时器</li>
</ul>
<p><img src="/imgs/image-20211218130310454.png" alt="image-20211218130310454"></p>
<p><img src="/imgs/image-20211218130352028.png" alt="image-20211218130352028"></p>
<p>然后在<code>freeRTOS.c</code>中的<strong>初始化函数</strong><code>MX_FREERTOS_Init</code>中添加启动定时器的语句</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MX_FREERTOS_Init</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN RTOS_MUTEX */</span></span><br><span class="line">  <span class="comment">/* add mutexes, ... */</span></span><br><span class="line">  <span class="comment">/* USER CODE END RTOS_MUTEX */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN RTOS_SEMAPHORES */</span></span><br><span class="line">  <span class="comment">/* add semaphores, ... */</span></span><br><span class="line">  <span class="comment">/* USER CODE END RTOS_SEMAPHORES */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Create the timer(s) */</span></span><br><span class="line">  <span class="comment">/* creation of myTimer01 */</span></span><br><span class="line">  myTimer01Handle = osTimerNew(refreshScreen, osTimerPeriodic, <span class="literal">NULL</span>, &amp;myTimer01_attributes);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* creation of myTimer02 */</span></span><br><span class="line">  myTimer02Handle = osTimerNew(drawString, osTimerPeriodic, <span class="literal">NULL</span>, &amp;myTimer02_attributes);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN RTOS_TIMERS */</span></span><br><span class="line">  osTimerStart(myTimer01Handle, <span class="number">500</span>);</span><br><span class="line">  osTimerStart(myTimer02Handle, <span class="number">500</span>);</span><br><span class="line">  <span class="comment">/* start timers, add new ones, ... */</span></span><br><span class="line">  <span class="comment">/* USER CODE END RTOS_TIMERS */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Create the queue(s) */</span></span><br><span class="line">  <span class="comment">/* creation of colorQ */</span></span><br><span class="line">  colorQHandle = osMessageQueueNew (<span class="number">16</span>, <span class="keyword">sizeof</span>(<span class="keyword">uint8_t</span>), &amp;colorQ_attributes);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN RTOS_QUEUES */</span></span><br><span class="line">  <span class="comment">/* add queues, ... */</span></span><br><span class="line">  <span class="comment">/* USER CODE END RTOS_QUEUES */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Create the thread(s) */</span></span><br><span class="line">  <span class="comment">/* creation of drawColor */</span></span><br><span class="line">  drawColorHandle = osThreadNew(StartDefaultTask, <span class="literal">NULL</span>, &amp;drawColor_attributes);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN RTOS_THREADS */</span></span><br><span class="line">  <span class="comment">/* add threads, ... */</span></span><br><span class="line">  <span class="comment">/* USER CODE END RTOS_THREADS */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN RTOS_EVENTS */</span></span><br><span class="line">  <span class="comment">/* add events, ... */</span></span><br><span class="line">  <span class="comment">/* USER CODE END RTOS_EVENTS */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>队列从Cube里直接创建即可，不需要额外的代码启动。</li>
<li>队列相关的操作函数在<code>cmsis_os2.h</code>中，如图</li>
<li><img src="/imgs/image-20211218130544220.png" alt="image-20211218130544220"></li>
</ul>
<h2 id="测试CMSIS-V2使用ili9341驱动"><a href="#测试CMSIS-V2使用ili9341驱动" class="headerlink" title="测试CMSIS_V2使用ili9341驱动"></a>测试CMSIS_V2使用ili9341驱动</h2><ul>
<li><p>能开始像芯片发送一次左右的指令，然后就会不知道因为什么原因（猜测是SPI）进入hardFault无限循环</p>
</li>
<li><p><img src="/imgs/image-20211218132008015.png" alt="image-20211218132008015"></p>
</li>
<li><p>认为还是<strong>只能用</strong><code>CMSIS_V1</code>进行操作。</p>
</li>
<li><p>尝试过SPI和DMA都不使用freeRTOS的中断，中断都比RTOS高，也尝试过DMA不用而SPI用，<strong>都不行。</strong></p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-解决C语言变量被重复定义错误的问题"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/17/%E8%A7%A3%E5%86%B3C%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F%E8%A2%AB%E9%87%8D%E5%A4%8D%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E7%9A%84%E9%97%AE%E9%A2%98/"
    >解决C语言变量被重复定义错误的问题</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/17/%E8%A7%A3%E5%86%B3C%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F%E8%A2%AB%E9%87%8D%E5%A4%8D%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2021-12-17T15:10:42.000Z" itemprop="datePublished">2021-12-17</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="解决C语言变量被重复定义错误的问题"><a href="#解决C语言变量被重复定义错误的问题" class="headerlink" title="解决C语言变量被重复定义错误的问题"></a>解决C语言变量被重复定义错误的问题</h1><h2 id="头文件编译的原理"><a href="#头文件编译的原理" class="headerlink" title="头文件编译的原理"></a>头文件编译的原理</h2><ul>
<li>在每次头文件被某个.c文件include的时候，头文件头会被插入到代码中<code>#include &quot;xxx.h&quot;</code>的位置，假如在头文件中定义了变量，然后这个头文件被多个.c文件同时Include的话，就会导致头文件中的变量以同样的名称被定义多次。因此产生错误</li>
</ul>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ul>
<li>就是在定义该变量的.c文件的头文件中（或者需要用到在其他.c文件中定义的变量的文件中）给对应的变量加<code>extern</code>关键字定义，此时会意味着这个变量是在其他位置被定义的，在此处仅仅是声明一下，而不是定义，也不分配内存空间。此时在该文件被其他.c文件Include的时候，就不会使得变量被定义多次。</li>
<li>或者使用<code>#ifndef</code>，<code>#define XX</code>，<code>#endif</code>防止if块中的内容被定义多次。</li>
</ul>
<h2 id="其他知识点"><a href="#其他知识点" class="headerlink" title="其他知识点"></a>其他知识点</h2><ul>
<li><p>C语言中两种方式使用#include命令,<code> #include &lt;&gt;</code>与<code>#include ””</code>的区别</p>
</li>
<li><p>一种是在包含指令<code>#include</code>后面”&lt;&gt;”将头文件名括起来。这种方式用于<strong>标准或系统提供</strong>的头文件，到保存系统标准头文件的位置查找头文件。</p>
</li>
<li><p>另一种是在包含指令<code>#include</code>后用双引号””将头文件包括起来。这种方式常用与<strong>程序员自己的头文件</strong>。用这种格式时，C编译器先查找当前目录是否有指定名称的头文件，然后在从标准头文件目录中查找。</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-使用FreeRTOS和ILI9341点亮LCD屏幕"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/17/%E4%BD%BF%E7%94%A8FreeRTOS%E5%92%8CILI9341%E7%82%B9%E4%BA%AELCD%E5%B1%8F%E5%B9%95/"
    >使用FreeRTOS和ILI9341点亮LCD屏幕</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/17/%E4%BD%BF%E7%94%A8FreeRTOS%E5%92%8CILI9341%E7%82%B9%E4%BA%AELCD%E5%B1%8F%E5%B9%95/" class="article-date">
  <time datetime="2021-12-17T13:35:25.000Z" itemprop="datePublished">2021-12-17</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="使用FreeRTOS和上一篇中提到的ili9341芯片驱动点亮屏幕"><a href="#使用FreeRTOS和上一篇中提到的ili9341芯片驱动点亮屏幕" class="headerlink" title="使用FreeRTOS和上一篇中提到的ili9341芯片驱动点亮屏幕"></a>使用FreeRTOS和上一篇中提到的ili9341芯片驱动点亮屏幕</h1><h2 id="CubeMX配置"><a href="#CubeMX配置" class="headerlink" title="CubeMX配置"></a>CubeMX配置</h2><ul>
<li><p>SPI：</p>
</li>
<li><p><img src="/imgs/image-20211217213656004.png" alt="image-20211217213656004"></p>
</li>
<li><p>DMA：</p>
</li>
<li><p><img src="/imgs/image-20211217213717712.png" alt="image-20211217213717712"></p>
</li>
<li><p>NVIC（重要）：</p>
</li>
<li><p><img src="/imgs/image-20211217213754825.png" alt="image-20211217213754825"></p>
</li>
<li><p>注意此处SPI、TIM1和DMA<strong>不要使用FreeRTOS 的中断函数</strong>，将对勾去掉，同时将中断优先级<strong>改为一个比FreeRTOS小的数字</strong>，比如2。假如使用了FreeRTOS的中断的话在Cube中无法修改这个数字为更小的值</p>
</li>
<li><p>FreeRTOS:</p>
</li>
<li><p><img src="/imgs/image-20211217213921708.png" alt="image-20211217213921708"></p>
</li>
<li><p>注意此处使用的是<strong>v1</strong>，尚未测试v2是否可以，其他内容（比如每个线程的堆栈空间之类的没有修改，默认应该是128字节）</p>
</li>
</ul>
<h2 id="程序配置"><a href="#程序配置" class="headerlink" title="程序配置"></a>程序配置</h2><p><strong>主程序</strong>中include如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ili9341.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ili9341_font.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ili9341_gfx.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>同时添加</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ili9341_t</span> *_lcd;</span><br><span class="line"><span class="keyword">ili9341_text_attr_t</span> fontSend1;</span><br><span class="line"><span class="keyword">ili9341_text_attr_t</span> fontSend2;</span><br><span class="line"><span class="function"><span class="keyword">ili9341_t</span> *<span class="title">screenReturn</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _lcd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>freeRTOS</strong>的C文件中添加上面的Include，此外还有</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">ili9341_text_attr_t</span> fontSend1;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">ili9341_text_attr_t</span> fontSend2;</span><br></pre></td></tr></table></figure>

<p>freeRTOS的<strong>线程</strong>定义如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* USER CODE END Header_startScreenFill */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">startScreenFill</span><span class="params">(<span class="keyword">void</span> <span class="keyword">const</span> * argument)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN startScreenFill */</span></span><br><span class="line">  <span class="comment">/* Infinite loop */</span></span><br><span class="line">  <span class="keyword">for</span>(;;)</span><br><span class="line">  &#123;</span><br><span class="line">    ili9341_fill_screen(screenReturn(),ILI9341_BLUE);</span><br><span class="line">    osDelay(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* USER CODE END startScreenFill */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意不同的线程要区分优先级，如图</li>
<li><img src="/imgs/image-20211217220230058.png" alt="image-20211217220230058"></li>
</ul>
<h2 id="文中没有提到的按照上一篇博客的操作"><a href="#文中没有提到的按照上一篇博客的操作" class="headerlink" title="文中没有提到的按照上一篇博客的操作"></a>文中没有提到的按照上一篇博客的操作</h2><h2 id="效果如图"><a href="#效果如图" class="headerlink" title="效果如图"></a>效果如图</h2><p><img src="/imgs/20211217220332.gif" alt="20211217220332"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-STM32F4点亮ili9341驱动的屏幕（HAL库）2"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/16/STM32F4%E7%82%B9%E4%BA%AEili9341%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%B1%8F%E5%B9%95%EF%BC%88HAL%E5%BA%93%EF%BC%892/"
    >STM32F4点亮ili9341驱动的屏幕（HAL库）2</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/16/STM32F4%E7%82%B9%E4%BA%AEili9341%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%B1%8F%E5%B9%95%EF%BC%88HAL%E5%BA%93%EF%BC%892/" class="article-date">
  <time datetime="2021-12-16T02:36:21.000Z" itemprop="datePublished">2021-12-16</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="STM32F4点亮ili9341驱动的屏幕（HAL库）2"><a href="#STM32F4点亮ili9341驱动的屏幕（HAL库）2" class="headerlink" title="STM32F4点亮ili9341驱动的屏幕（HAL库）2"></a>STM32F4点亮ili9341驱动的屏幕（HAL库）2</h1><h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ardnew/ILI9341-STM32-HAL">https://github.com/ardnew/ILI9341-STM32-HAL</a></li>
</ul>
<h2 id="Cube配置"><a href="#Cube配置" class="headerlink" title="Cube配置"></a>Cube配置</h2><p>按照readme中的配置，注意以下问题</p>
<ul>
<li>SPI设置（打开中断）：</li>
<li><img src="/imgs/image-20211216141849088.png" alt="image-20211216141849088"></li>
<li>DMA：</li>
<li><img src="/imgs/image-20211216141832051.png" alt="image-20211216141832051"></li>
<li>生成项目</li>
<li><img src="/imgs/image-20211218120959770.png" alt="image-20211218120959770"></li>
</ul>
<h3 id="编译注意事项"><a href="#编译注意事项" class="headerlink" title="编译注意事项"></a>编译注意事项</h3><ul>
<li><p>注意在Flash中将库的目录添加到C/C++目录下</p>
</li>
<li><p><img src="/imgs/image-20211216142551872.png" alt="image-20211216142551872"></p>
</li>
<li><p><img src="/imgs/image-20211216142622319.png" alt="image-20211216142622319"></p>
</li>
<li><p>在<code>ili9341.h</code>文件添加<code>#pragma anon_unions</code>允许union类型</p>
</li>
<li><p>在keil编译配置管理的c/c++选项卡中Misc control中填写<code>--gnu</code></p>
</li>
<li><p><img src="/imgs/image-20211216141659806.png" alt="image-20211216141659806"></p>
</li>
<li><p>可能会出现未定义<code>MX_SPI1_Init();</code>的问题，在<code>main.c</code>文件中手动添加<code>dma.h</code>的include</p>
</li>
<li><p>lcd初始化示例（执行这个函数即可），返回一个<code>ili9341_t *</code>对象</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">_lcd = ili9341_new(</span><br><span class="line">  &amp;hspi1,</span><br><span class="line">  GPIOC, GPIO_PIN_6,</span><br><span class="line">  GPIOC,    GPIO_PIN_7,</span><br><span class="line">  GPIOC,    GPIO_PIN_8,</span><br><span class="line">  isoLandscape,</span><br><span class="line">  GPIOD,  GPIO_PIN_15,</span><br><span class="line">  GPIOD, GPIO_PIN_15,</span><br><span class="line">  itsNONE,</span><br><span class="line">  itnNONE);</span><br></pre></td></tr></table></figure>

<ul>
<li>注意，不使用触摸功能的时候后面几个输入填写任意不用的引脚即可，最后两个写<code>***NONE</code>，有枚举类型的定义</li>
<li><strong>不需要</strong>手动执行<code>init</code>之类的函数，之前那个<code>_new</code>中已经包括了</li>
</ul>
<h3 id="速度比上一个还是快一些"><a href="#速度比上一个还是快一些" class="headerlink" title="速度比上一个还是快一些"></a>速度比上一个还是快一些</h3> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-STM32点亮ili9341驱动的屏幕（HAL库第一版）"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/15/STM32%E7%82%B9%E4%BA%AEili9341%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%B1%8F%E5%B9%95%EF%BC%88HAL%E5%BA%93%E7%AC%AC%E4%B8%80%E7%89%88%EF%BC%89/"
    >STM32点亮ILI9341驱动的屏幕（HAL库）</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/15/STM32%E7%82%B9%E4%BA%AEili9341%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%B1%8F%E5%B9%95%EF%BC%88HAL%E5%BA%93%E7%AC%AC%E4%B8%80%E7%89%88%EF%BC%89/" class="article-date">
  <time datetime="2021-12-15T11:48:42.000Z" itemprop="datePublished">2021-12-15</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="STM32F407点亮ILI9341驱动的屏幕"><a href="#STM32F407点亮ILI9341驱动的屏幕" class="headerlink" title="STM32F407点亮ILI9341驱动的屏幕"></a>STM32F407点亮ILI9341驱动的屏幕</h1><h2 id="驱动网址"><a href="#驱动网址" class="headerlink" title="驱动网址"></a>驱动网址</h2><p>（国内镜像）</p>
<p><a target="_blank" rel="noopener" href="https://hub.fastgit.org/afiskon/stm32-ili9341">https://hub.fastgit.org/afiskon/stm32-ili9341</a></p>
<h2 id="接线"><a href="#接线" class="headerlink" title="接线"></a>接线</h2><ul>
<li>屏幕的供电是3.3V</li>
<li>SCL是时钟，接SCK</li>
<li>SDA是输入信号，接MOSI</li>
<li>其他接对应的输出引脚即可</li>
</ul>
<h2 id="Cube配置"><a href="#Cube配置" class="headerlink" title="Cube配置"></a>Cube配置</h2><ul>
<li>SPI设置（不需要设置为全双工 ，只需要设置为<strong>纯发送</strong>即可）</li>
</ul>
<p><img src="/imgs/image-20211215215305442.png" alt="image-20211215215305442"></p>
<ul>
<li>但是STM32F4使用HAL库配置的时候的结果与github上的驱动效果略有不同，也就是波特率位42.0MBits/s</li>
<li><img src="/imgs/image-20211215201627479.png" alt="image-20211215201627479"></li>
</ul>
<h2 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h2><p>先把ili9341文件夹（在src文件夹中）复制到项目文件夹下</p>
<p><img src="/imgs/image-20211215202205389.png" alt="image-20211215202205389"></p>
<p>然后在此处将其添加到paths</p>
<p><img src="/imgs/image-20211215202351571.png" alt="image-20211215202351571"></p>
<p>然后通过add existing files to group… 添加ili9341目录下的文件</p>
<ul>
<li><p>然后修改ili9341的头文件</p>
</li>
<li><p><img src="/imgs/image-20211215215407292.png" alt="image-20211215215407292"></p>
</li>
<li><p>还有</p>
</li>
<li><p><img src="/imgs/image-20211215215423986.png" alt="image-20211215215423986"></p>
</li>
<li><p>然后在主程序中include相关的头文件</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ili9341.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;fonts.h&quot;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="粗略写程序如下"><a href="#粗略写程序如下" class="headerlink" title="粗略写程序如下"></a>粗略写程序如下</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* MCU Configuration--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span></span><br><span class="line">  HAL_Init();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Configure the system clock */</span></span><br><span class="line">  SystemClock_Config();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN SysInit */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END SysInit */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Initialize all configured peripherals */</span></span><br><span class="line">  MX_GPIO_Init();</span><br><span class="line">  MX_SPI1_Init();</span><br><span class="line">  MX_USART1_UART_Init();</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">  ILI9341_Init();</span><br><span class="line">  <span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Infinite loop */</span></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN WHILE */</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/* USER CODE END WHILE */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line">    ILI9341_FillScreen(ILI9341_BLUE);</span><br><span class="line">    ILI9341_WriteString(<span class="number">0</span>,<span class="number">10</span>,<span class="string">&quot;Hello World!&quot;</span>, Font_7x10, ILI9341_WHITE, ILI9341_BLACK);</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    ILI9341_FillScreen(ILI9341_GREEN);</span><br><span class="line">    ILI9341_WriteString(<span class="number">0</span>,<span class="number">10</span>,<span class="string">&quot;Hello World!&quot;</span>, Font_7x10, ILI9341_WHITE, ILI9341_BLACK);</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    HAL_UART_Transmit(&amp;huart1,textSend,<span class="number">5</span>,<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* USER CODE END 3 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程"><a href="#但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程" class="headerlink" title="但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程"></a>但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程</h3><p><img src="/imgs/1639576655398.gif" alt="image-20211215220004575"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-freeRtos内存分配"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/14/freeRtos%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"
    >FreeRtos内存分配</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/14/freeRtos%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" class="article-date">
  <time datetime="2021-12-14T14:29:57.000Z" itemprop="datePublished">2021-12-14</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="内存分配的种类"><a href="#内存分配的种类" class="headerlink" title="内存分配的种类"></a>内存分配的种类</h1><p>本文转载自<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115276865">https://zhuanlan.zhihu.com/p/115276865</a></p>
<h2 id="堆栈的关系"><a href="#堆栈的关系" class="headerlink" title="堆栈的关系"></a>堆栈的关系</h2><p><img src="/imgs/image-20211214224037834.png" alt="image-20211214224037834"></p>
<p>​    如上图的示例程序所示，全局变量和常量属于静态区（Static)，由编译器事先分配好，生命周期贯穿整个程序；函数的参数值，局部变量的值属于栈（Stack），由编译器自动分配和释放；程序员用malloc函数动态请求分配的内存空间属于堆（Heap）。<em>值得注意的是，如果在动态分配的内存用完之后忘记使用free函数释放内存，则会导致内存泄漏，并且当堆和栈无止境的增长到互相覆盖对方区域时则会出现很多无法预料的问题。程序可能运行运行着就跑飞了。</em></p>
<h2 id="FreeRtos-任务空间构成"><a href="#FreeRtos-任务空间构成" class="headerlink" title="FreeRtos 任务空间构成"></a>FreeRtos 任务空间构成</h2><p><img src="/imgs/image-20211214230245382.png" alt="image-20211214230245382"></p>
<p>如上图所示，当调用FreeRTOS的创建任务API函数<code>xTaskCreate()</code>时，FreeRTOS会在堆中开辟出一块空间，用于存放<strong>任务的控制信息TCB块</strong>和<strong>栈区Stack</strong>用于储存任务相关的变量。图中创建的两个任务Task1和Task2都有各自独立的内存空间，互相独立。如果想在静态区建立任务的话可以调用<code>xTaskCreateStatic()</code>函数。</p>
<ul>
<li>注意，程序运行过程中<strong>动态创建的线程</strong>的内存位置在堆中，堆中分配的空间包括程序自身的TCB块和自身的<strong>栈</strong>，也就是程序的<strong>Stack</strong></li>
</ul>
<h3 id="TCB块的大小"><a href="#TCB块的大小" class="headerlink" title="TCB块的大小"></a>TCB块的大小</h3><p>​    <em>TCB块的大小取决于<strong>FreeRTOSConfig.h</strong>头文件中的设置</em></p>
<ul>
<li><p>在最小的设置下TCB块的大小是96字节</p>
</li>
<li><p>如果<strong>configUSE_TASK_NOTIFICATIONS</strong>是1的话再增加8个字节</p>
</li>
<li><p>如果<strong>configUSE_TRACE_FACILITY</strong>是1的话再增加8个字节</p>
</li>
<li><p>如果<strong>configUSE_MUTEXES</strong>是1的话再增加8个字节</p>
</li>
</ul>
<p>上一章节中的任务TCB块因为这三个选项都为1，所以大小为96+8+8+8=120字节。</p>
<p>总结下来 <strong>任务占用字节数 = TCB_size + (4 x Task stack size)</strong></p>
<h2 id="TCB块的大小-1"><a href="#TCB块的大小-1" class="headerlink" title="TCB块的大小"></a>TCB块的大小</h2><p><em>TCB块的大小取决于<strong>FreeRTOSConfig.h</strong>头文件中的设置</em></p>
<ul>
<li>在最小的设置下TCB块的大小是96字节</li>
<li>如果<strong>configUSE_TASK_NOTIFICATIONS</strong>是1的话再增加8个字节</li>
<li>如果<strong>configUSE_TRACE_FACILITY</strong>是1的话再增加8个字节</li>
<li>如果<strong>configUSE_MUTEXES</strong>是1的话再增加8个字节</li>
</ul>
<p>上一章节中的任务TCB块因为这三个选项都为1，所以大小为96+8+8+8=120字节。</p>
<p>总结下来 <strong>任务占用字节数 = TCB_size + (4 x Task stack size)</strong></p>
<h2 id="MSP和PSP栈指针"><a href="#MSP和PSP栈指针" class="headerlink" title="MSP和PSP栈指针"></a><strong>MSP和PSP栈指针</strong></h2><p>在FreeRTOS中维护着两个栈的指针，分别是MSP主堆栈指针(Main stack pointer)和PSP进程堆栈指针(Process stack pointer)。</p>
<p>两个栈指针的区别是</p>
<h3 id="MSP指针"><a href="#MSP指针" class="headerlink" title="MSP指针"></a>MSP指针</h3><ul>
<li>用于操作内核以及处理异常和中断</li>
<li>由编译器分配</li>
</ul>
<h3 id="PSP指针"><a href="#PSP指针" class="headerlink" title="PSP指针"></a>PSP指针</h3><ul>
<li><p>用于每个任务的独立的栈指针</p>
</li>
<li><p>在任务调度上下文切换(context switch)中，PSP会初始化为相对应的任务的栈指针，如下图所示</p>
<p><img src="/imgs/image-20211214230729141-16394963018092.png" alt="image-20211214230729141"></p>
<p><strong><u>通常MSP指针用于系统内核和中断服务函数，PSP指针用于用户的任务。</u></strong></p>
</li>
</ul>
<h2 id="Heap-1"><a href="#Heap-1" class="headerlink" title="Heap_1"></a>Heap_1</h2><p>本方案适用于小型的嵌入式系统，并且这个系统<strong>只能在调度器启动之前创建任务和其它内核对象</strong>。内存只需要在程序启动调度器前采用first fit算法对内存进行动态分配，<strong>之后任务的内存分配在程序的运行周期中保持不变并且无法被释放</strong>。heap_1.c实现了一个基础版本的pvPortMalloc函数，并没有实现vPortFree这个函数。如果系统运行后<strong>不用删除任务或者内核对象</strong>就可以采用这个方案。<strong>一些不需要动态分配内存的安全相关的系统</strong>也可以采用这个方案，因为这个方案是可确定性的（deterministic）所以<strong>不会导致内存碎片化</strong>。这个方案中堆由一个数组实现，数组的大小由<strong>FreeRTOSConfig.h</strong>文件中configTOTAL_HEAP_SIZE定义</p>
<p><img src="/imgs/image-20211214223607533.png" alt="image-20211214223607533"></p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li>内存分配示例如下，A表示没有任何任务创建时的内存；B表示一个任务（<strong>每个任务有自己的TCB块和栈区</strong>）被创建时的内存分配情况；C表示三个任务被创建时的分配情况。</li>
<li><img src="/imgs/image-20211214223641571.png" alt="image-20211214223641571"></li>
</ul>
<h2 id="Heap-2"><a href="#Heap-2" class="headerlink" title="Heap_2"></a>Heap_2</h2><p>这个方案用于保持FreeRTOS的向下兼容性，<strong>并不推荐使用</strong>。内存管理也由一个数组实现，大小由FreeRTOSConfig.h文件中configTOTAL_HEAP_SIZE定义。它通过一套 <strong>优化算法</strong> （best fit algorithm）对内存进行分配，并允许释放内存。Heap_4是Heap_2的功能强化版本。</p>
<p>best fit 算法确保pvPortMalloc函数分配大小最接近所需要字节的内存空间。它会对大的内存块进行分割，但无法合并相连的内存块。Heap_2适用于<strong>重复添加和删除相同任务的系统</strong>，但这种系统应该十分少见。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><ul>
<li>内存分配示例如下，A表示有三个任务被创建时的内存分配情况；B表示有一个任务被删除时的分配情况，此时有两个小的内存块空闲出来；C表示另一个相同任务被创建时的分配情况，因为这个对TCB块和栈区大小的要求和之前被删除任务的大小一样，best fit 算法便把之前被释放的内存块分配给它。</li>
<li><img src="/imgs/image-20211214223823014.png" alt="image-20211214223823014"></li>
</ul>
<h2 id="Heap-3"><a href="#Heap-3" class="headerlink" title="Heap_3"></a>Heap_3</h2><p>本方案使用标准库里的malloc和free函数，所以堆的大小由链接器配置决定，不受configTOTAL_HEAP_SIZE大小影响。因为这个方案使用的场景不多，所以在这里不作详细介绍。</p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p><img src="/imgs/image-20211214232509178.png" alt="image-20211214232509178"></p>
<p>可以看到Heap_3使用<strong>标准库</strong>里的malloc和free函数对任务进行内存分配和释放</p>
<h2 id="Heap-5"><a href="#Heap-5" class="headerlink" title="Heap_5"></a>Heap_5</h2><p>这个方案使用类似于Heap_4的内存分配技术，但不同于Heap_4只用一个连续的数组表示堆，Heap_5可以用不同的数组空间对内存进行分配。在本方案要使用vPortDefineHeapRegions这个函数对不同的数组进行申明。</p>
<h3 id="Heap-5-示例"><a href="#Heap-5-示例" class="headerlink" title="Heap_5 示例"></a>Heap_5 示例</h3><p>下面这张图定义了三个不同内存空间用于模拟堆。程序如下，首先定义了每个区域的开始地址START_ADDRESS和空间大小SIZE，然后用一个结构体xHeapRegions指向了这些区域，最后使用<code>vPortDefineHeapRegions</code>函数申明堆的空间。</p>
<p><img src="/imgs/image-20211214234455862.png" alt="image-20211214234455862"></p>
<p><img src="/imgs/image-20211214234514596.png" alt="image-20211214234514596"></p>
<ul>
<li>上图为声明空间的举例</li>
</ul>
<h2 id="内存管理相关函数"><a href="#内存管理相关函数" class="headerlink" title="内存管理相关函数"></a>内存管理相关函数</h2><ul>
<li><p><code>size_t xPortGetFreeHeapSize( void );</code></p>
</li>
<li><p>这个函数会返回当前堆中的空闲空间，可以用来优化堆空间大小。比如在系统运行起来后调用xPortGetFreeHeapSize如果返回了3000，就可以把堆大小configTOTAL_HEAP_SIZE设置为3000。</p>
</li>
<li><p><code>size_t xPortGetMinimumEverFreeHeapSize( void );</code></p>
</li>
<li><p>这个函数会返回在系统运行过程中堆空间的最小空闲空间，如果最小空闲空间很小的话可以考虑提高堆大小configTOTAL_HEAP_SIZE的值。</p>
</li>
<li><p><code>void vApplicationMallocFailedHook( void );</code></p>
</li>
<li><p>这是一个回调函数，需要用户自己实现。如果配置文件中configUSE_MALLOC_FAILED_HOOK 设置为1的话，当堆分配内存失败时会调用此函数。用户可以在此函数中进行错误处理。</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/10/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/12/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021-2023
        <i class="ri-heart-fill heart_icon"></i> FrankZhang
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/avatar.png" alt="Frank’s blogs"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>