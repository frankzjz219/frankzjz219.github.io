<!DOCTYPE html>


<html lang="Chinese">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Frank’s blogs</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/FLogo.png" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/bkgPic.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Frank’s blogs</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['Linux开发和工科生折腾集锦', '算法题总结', 'C/C++/python等开发'],
        startDelay: 0,
        typeSpeed: 100,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  
<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content">Linux编程、C/C++开发、算法题、各种工科生折腾开发集锦</div>
</div>


<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-STM32点亮ili9341驱动的屏幕（HAL库第一版）"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/15/STM32%E7%82%B9%E4%BA%AEili9341%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%B1%8F%E5%B9%95%EF%BC%88HAL%E5%BA%93%E7%AC%AC%E4%B8%80%E7%89%88%EF%BC%89/"
    >STM32点亮ILI9341驱动的屏幕（HAL库）</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/15/STM32%E7%82%B9%E4%BA%AEili9341%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%B1%8F%E5%B9%95%EF%BC%88HAL%E5%BA%93%E7%AC%AC%E4%B8%80%E7%89%88%EF%BC%89/" class="article-date">
  <time datetime="2021-12-15T11:48:42.000Z" itemprop="datePublished">2021-12-15</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="STM32F407点亮ILI9341驱动的屏幕"><a href="#STM32F407点亮ILI9341驱动的屏幕" class="headerlink" title="STM32F407点亮ILI9341驱动的屏幕"></a>STM32F407点亮ILI9341驱动的屏幕</h1><h2 id="驱动网址"><a href="#驱动网址" class="headerlink" title="驱动网址"></a>驱动网址</h2><p>（国内镜像）</p>
<p><a target="_blank" rel="noopener" href="https://hub.fastgit.org/afiskon/stm32-ili9341">https://hub.fastgit.org/afiskon/stm32-ili9341</a></p>
<h2 id="接线"><a href="#接线" class="headerlink" title="接线"></a>接线</h2><ul>
<li>屏幕的供电是3.3V</li>
<li>SCL是时钟，接SCK</li>
<li>SDA是输入信号，接MOSI</li>
<li>其他接对应的输出引脚即可</li>
</ul>
<h2 id="Cube配置"><a href="#Cube配置" class="headerlink" title="Cube配置"></a>Cube配置</h2><ul>
<li>SPI设置（不需要设置为全双工 ，只需要设置为<strong>纯发送</strong>即可）</li>
</ul>
<p><img src="/imgs/image-20211215215305442.png" alt="image-20211215215305442"></p>
<ul>
<li>但是STM32F4使用HAL库配置的时候的结果与github上的驱动效果略有不同，也就是波特率位42.0MBits/s</li>
<li><img src="/imgs/image-20211215201627479.png" alt="image-20211215201627479"></li>
</ul>
<h2 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h2><p>先把ili9341文件夹（在src文件夹中）复制到项目文件夹下</p>
<p><img src="/imgs/image-20211215202205389.png" alt="image-20211215202205389"></p>
<p>然后在此处将其添加到paths</p>
<p><img src="/imgs/image-20211215202351571.png" alt="image-20211215202351571"></p>
<p>然后通过add existing files to group… 添加ili9341目录下的文件</p>
<ul>
<li><p>然后修改ili9341的头文件</p>
</li>
<li><p><img src="/imgs/image-20211215215407292.png" alt="image-20211215215407292"></p>
</li>
<li><p>还有</p>
</li>
<li><p><img src="/imgs/image-20211215215423986.png" alt="image-20211215215423986"></p>
</li>
<li><p>然后在主程序中include相关的头文件</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ili9341.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;fonts.h&quot;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="粗略写程序如下"><a href="#粗略写程序如下" class="headerlink" title="粗略写程序如下"></a>粗略写程序如下</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* MCU Configuration--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span></span><br><span class="line">  HAL_Init();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Configure the system clock */</span></span><br><span class="line">  SystemClock_Config();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN SysInit */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END SysInit */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Initialize all configured peripherals */</span></span><br><span class="line">  MX_GPIO_Init();</span><br><span class="line">  MX_SPI1_Init();</span><br><span class="line">  MX_USART1_UART_Init();</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">  ILI9341_Init();</span><br><span class="line">  <span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Infinite loop */</span></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN WHILE */</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/* USER CODE END WHILE */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line">    ILI9341_FillScreen(ILI9341_BLUE);</span><br><span class="line">    ILI9341_WriteString(<span class="number">0</span>,<span class="number">10</span>,<span class="string">&quot;Hello World!&quot;</span>, Font_7x10, ILI9341_WHITE, ILI9341_BLACK);</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    ILI9341_FillScreen(ILI9341_GREEN);</span><br><span class="line">    ILI9341_WriteString(<span class="number">0</span>,<span class="number">10</span>,<span class="string">&quot;Hello World!&quot;</span>, Font_7x10, ILI9341_WHITE, ILI9341_BLACK);</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    HAL_UART_Transmit(&amp;huart1,textSend,<span class="number">5</span>,<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* USER CODE END 3 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程"><a href="#但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程" class="headerlink" title="但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程"></a>但是这个驱动的效果不是特别好，刷新比较慢，会有明显的刷新过程</h3><p><img src="/imgs/1639576655398.gif" alt="image-20211215220004575"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-freeRtos内存分配"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/14/freeRtos%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"
    >FreeRtos内存分配</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/14/freeRtos%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" class="article-date">
  <time datetime="2021-12-14T14:29:57.000Z" itemprop="datePublished">2021-12-14</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="内存分配的种类"><a href="#内存分配的种类" class="headerlink" title="内存分配的种类"></a>内存分配的种类</h1><p>本文转载自<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115276865">https://zhuanlan.zhihu.com/p/115276865</a></p>
<h2 id="堆栈的关系"><a href="#堆栈的关系" class="headerlink" title="堆栈的关系"></a>堆栈的关系</h2><p><img src="/imgs/image-20211214224037834.png" alt="image-20211214224037834"></p>
<p>​    如上图的示例程序所示，全局变量和常量属于静态区（Static)，由编译器事先分配好，生命周期贯穿整个程序；函数的参数值，局部变量的值属于栈（Stack），由编译器自动分配和释放；程序员用malloc函数动态请求分配的内存空间属于堆（Heap）。<em>值得注意的是，如果在动态分配的内存用完之后忘记使用free函数释放内存，则会导致内存泄漏，并且当堆和栈无止境的增长到互相覆盖对方区域时则会出现很多无法预料的问题。程序可能运行运行着就跑飞了。</em></p>
<h2 id="FreeRtos-任务空间构成"><a href="#FreeRtos-任务空间构成" class="headerlink" title="FreeRtos 任务空间构成"></a>FreeRtos 任务空间构成</h2><p><img src="/imgs/image-20211214230245382.png" alt="image-20211214230245382"></p>
<p>如上图所示，当调用FreeRTOS的创建任务API函数<code>xTaskCreate()</code>时，FreeRTOS会在堆中开辟出一块空间，用于存放<strong>任务的控制信息TCB块</strong>和<strong>栈区Stack</strong>用于储存任务相关的变量。图中创建的两个任务Task1和Task2都有各自独立的内存空间，互相独立。如果想在静态区建立任务的话可以调用<code>xTaskCreateStatic()</code>函数。</p>
<ul>
<li>注意，程序运行过程中<strong>动态创建的线程</strong>的内存位置在堆中，堆中分配的空间包括程序自身的TCB块和自身的<strong>栈</strong>，也就是程序的<strong>Stack</strong></li>
</ul>
<h3 id="TCB块的大小"><a href="#TCB块的大小" class="headerlink" title="TCB块的大小"></a>TCB块的大小</h3><p>​    <em>TCB块的大小取决于<strong>FreeRTOSConfig.h</strong>头文件中的设置</em></p>
<ul>
<li><p>在最小的设置下TCB块的大小是96字节</p>
</li>
<li><p>如果<strong>configUSE_TASK_NOTIFICATIONS</strong>是1的话再增加8个字节</p>
</li>
<li><p>如果<strong>configUSE_TRACE_FACILITY</strong>是1的话再增加8个字节</p>
</li>
<li><p>如果<strong>configUSE_MUTEXES</strong>是1的话再增加8个字节</p>
</li>
</ul>
<p>上一章节中的任务TCB块因为这三个选项都为1，所以大小为96+8+8+8=120字节。</p>
<p>总结下来 <strong>任务占用字节数 = TCB_size + (4 x Task stack size)</strong></p>
<h2 id="TCB块的大小-1"><a href="#TCB块的大小-1" class="headerlink" title="TCB块的大小"></a>TCB块的大小</h2><p><em>TCB块的大小取决于<strong>FreeRTOSConfig.h</strong>头文件中的设置</em></p>
<ul>
<li>在最小的设置下TCB块的大小是96字节</li>
<li>如果<strong>configUSE_TASK_NOTIFICATIONS</strong>是1的话再增加8个字节</li>
<li>如果<strong>configUSE_TRACE_FACILITY</strong>是1的话再增加8个字节</li>
<li>如果<strong>configUSE_MUTEXES</strong>是1的话再增加8个字节</li>
</ul>
<p>上一章节中的任务TCB块因为这三个选项都为1，所以大小为96+8+8+8=120字节。</p>
<p>总结下来 <strong>任务占用字节数 = TCB_size + (4 x Task stack size)</strong></p>
<h2 id="MSP和PSP栈指针"><a href="#MSP和PSP栈指针" class="headerlink" title="MSP和PSP栈指针"></a><strong>MSP和PSP栈指针</strong></h2><p>在FreeRTOS中维护着两个栈的指针，分别是MSP主堆栈指针(Main stack pointer)和PSP进程堆栈指针(Process stack pointer)。</p>
<p>两个栈指针的区别是</p>
<h3 id="MSP指针"><a href="#MSP指针" class="headerlink" title="MSP指针"></a>MSP指针</h3><ul>
<li>用于操作内核以及处理异常和中断</li>
<li>由编译器分配</li>
</ul>
<h3 id="PSP指针"><a href="#PSP指针" class="headerlink" title="PSP指针"></a>PSP指针</h3><ul>
<li><p>用于每个任务的独立的栈指针</p>
</li>
<li><p>在任务调度上下文切换(context switch)中，PSP会初始化为相对应的任务的栈指针，如下图所示</p>
<p><img src="/imgs/image-20211214230729141-16394963018092.png" alt="image-20211214230729141"></p>
<p><strong><u>通常MSP指针用于系统内核和中断服务函数，PSP指针用于用户的任务。</u></strong></p>
</li>
</ul>
<h2 id="Heap-1"><a href="#Heap-1" class="headerlink" title="Heap_1"></a>Heap_1</h2><p>本方案适用于小型的嵌入式系统，并且这个系统<strong>只能在调度器启动之前创建任务和其它内核对象</strong>。内存只需要在程序启动调度器前采用first fit算法对内存进行动态分配，<strong>之后任务的内存分配在程序的运行周期中保持不变并且无法被释放</strong>。heap_1.c实现了一个基础版本的pvPortMalloc函数，并没有实现vPortFree这个函数。如果系统运行后<strong>不用删除任务或者内核对象</strong>就可以采用这个方案。<strong>一些不需要动态分配内存的安全相关的系统</strong>也可以采用这个方案，因为这个方案是可确定性的（deterministic）所以<strong>不会导致内存碎片化</strong>。这个方案中堆由一个数组实现，数组的大小由<strong>FreeRTOSConfig.h</strong>文件中configTOTAL_HEAP_SIZE定义</p>
<p><img src="/imgs/image-20211214223607533.png" alt="image-20211214223607533"></p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li>内存分配示例如下，A表示没有任何任务创建时的内存；B表示一个任务（<strong>每个任务有自己的TCB块和栈区</strong>）被创建时的内存分配情况；C表示三个任务被创建时的分配情况。</li>
<li><img src="/imgs/image-20211214223641571.png" alt="image-20211214223641571"></li>
</ul>
<h2 id="Heap-2"><a href="#Heap-2" class="headerlink" title="Heap_2"></a>Heap_2</h2><p>这个方案用于保持FreeRTOS的向下兼容性，<strong>并不推荐使用</strong>。内存管理也由一个数组实现，大小由FreeRTOSConfig.h文件中configTOTAL_HEAP_SIZE定义。它通过一套 <strong>优化算法</strong> （best fit algorithm）对内存进行分配，并允许释放内存。Heap_4是Heap_2的功能强化版本。</p>
<p>best fit 算法确保pvPortMalloc函数分配大小最接近所需要字节的内存空间。它会对大的内存块进行分割，但无法合并相连的内存块。Heap_2适用于<strong>重复添加和删除相同任务的系统</strong>，但这种系统应该十分少见。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><ul>
<li>内存分配示例如下，A表示有三个任务被创建时的内存分配情况；B表示有一个任务被删除时的分配情况，此时有两个小的内存块空闲出来；C表示另一个相同任务被创建时的分配情况，因为这个对TCB块和栈区大小的要求和之前被删除任务的大小一样，best fit 算法便把之前被释放的内存块分配给它。</li>
<li><img src="/imgs/image-20211214223823014.png" alt="image-20211214223823014"></li>
</ul>
<h2 id="Heap-3"><a href="#Heap-3" class="headerlink" title="Heap_3"></a>Heap_3</h2><p>本方案使用标准库里的malloc和free函数，所以堆的大小由链接器配置决定，不受configTOTAL_HEAP_SIZE大小影响。因为这个方案使用的场景不多，所以在这里不作详细介绍。</p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p><img src="/imgs/image-20211214232509178.png" alt="image-20211214232509178"></p>
<p>可以看到Heap_3使用<strong>标准库</strong>里的malloc和free函数对任务进行内存分配和释放</p>
<h2 id="Heap-5"><a href="#Heap-5" class="headerlink" title="Heap_5"></a>Heap_5</h2><p>这个方案使用类似于Heap_4的内存分配技术，但不同于Heap_4只用一个连续的数组表示堆，Heap_5可以用不同的数组空间对内存进行分配。在本方案要使用vPortDefineHeapRegions这个函数对不同的数组进行申明。</p>
<h3 id="Heap-5-示例"><a href="#Heap-5-示例" class="headerlink" title="Heap_5 示例"></a>Heap_5 示例</h3><p>下面这张图定义了三个不同内存空间用于模拟堆。程序如下，首先定义了每个区域的开始地址START_ADDRESS和空间大小SIZE，然后用一个结构体xHeapRegions指向了这些区域，最后使用<code>vPortDefineHeapRegions</code>函数申明堆的空间。</p>
<p><img src="/imgs/image-20211214234455862.png" alt="image-20211214234455862"></p>
<p><img src="/imgs/image-20211214234514596.png" alt="image-20211214234514596"></p>
<ul>
<li>上图为声明空间的举例</li>
</ul>
<h2 id="内存管理相关函数"><a href="#内存管理相关函数" class="headerlink" title="内存管理相关函数"></a>内存管理相关函数</h2><ul>
<li><p><code>size_t xPortGetFreeHeapSize( void );</code></p>
</li>
<li><p>这个函数会返回当前堆中的空闲空间，可以用来优化堆空间大小。比如在系统运行起来后调用xPortGetFreeHeapSize如果返回了3000，就可以把堆大小configTOTAL_HEAP_SIZE设置为3000。</p>
</li>
<li><p><code>size_t xPortGetMinimumEverFreeHeapSize( void );</code></p>
</li>
<li><p>这个函数会返回在系统运行过程中堆空间的最小空闲空间，如果最小空闲空间很小的话可以考虑提高堆大小configTOTAL_HEAP_SIZE的值。</p>
</li>
<li><p><code>void vApplicationMallocFailedHook( void );</code></p>
</li>
<li><p>这是一个回调函数，需要用户自己实现。如果配置文件中configUSE_MALLOC_FAILED_HOOK 设置为1的话，当堆分配内存失败时会调用此函数。用户可以在此函数中进行错误处理。</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-git常用命令"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/13/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"
    >git常用命令</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/13/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-date">
  <time datetime="2021-12-13T06:56:17.000Z" itemprop="datePublished">2021-12-13</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="git-常见命令"><a href="#git-常见命令" class="headerlink" title="git 常见命令"></a>git 常见命令</h1><p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/896043488029600">https://www.liaoxuefeng.com/wiki/896043488029600</a></p>
<p>一次添加目录下所有文件（ <strong>包括gitignore</strong> 的文件）：</p>
<p><code>git add . -f</code></p>
<p>一次添加目录下的所有文件（ <strong>不包括gitignore</strong> 的文件）：</p>
<p><code> git add .</code></p>
<p>一次<code>commit</code> 所有东西</p>
<p><code> git commit -a -m &lt;信息&gt;</code></p>
<p>一次添加目录下的所有东西：</p>
<p><code>git add 文件夹名/*</code></p>
<p>上传出问题的时候（上传 <strong>被拒绝</strong> 的时候）的解决方法：</p>
<p><code>git push -u origin master -f</code></p>
<p>这个会 <strong>丢弃</strong> 所有远程仓库领先于本地仓库的部分， <strong>强行</strong> 将本地仓库的内容推送到远端 </p>
<p>或下面这个，但是这个可能会 <strong>覆盖一些本地的文件</strong> （主要是多人开发的情况下可能会出现）</p>
<p><code>git pull origin master --allow-unrelated-histories</code></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-FreeRtos2"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/11/FreeRtos2/"
    >FreeRtos2</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/11/FreeRtos2/" class="article-date">
  <time datetime="2021-12-11T10:03:10.000Z" itemprop="datePublished">2021-12-11</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="FreeRtos创建注意（使用CubeMX）"><a href="#FreeRtos创建注意（使用CubeMX）" class="headerlink" title="FreeRtos创建注意（使用CubeMX）"></a>FreeRtos创建注意（使用CubeMX）</h2><ul>
<li><p>创建按照前篇知乎上的文章创建即可，注意此时会提示Systick的问题，设置为外部时钟晶振，而且设置为TIM1（或者其他timer可能也可以，没有尝试过）</p>
</li>
<li><p><img src="/imgs/image-20211214001535585.png" alt="image-20211214001535585"></p>
</li>
<li><p>然后另一个可能存在的问题是在<code>freertos.c</code> 文件中定义一些与<code>UART</code>相关的东西的时候会因为没有<code>#include &quot;usart.h&quot;</code>而出错，此时加上引用即可</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-FreeRtos1"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/11/FreeRtos1/"
    >FreeRtos1</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/11/FreeRtos1/" class="article-date">
  <time datetime="2021-12-11T10:03:10.000Z" itemprop="datePublished">2021-12-11</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="资源连接集合"><a href="#资源连接集合" class="headerlink" title="资源连接集合"></a>资源连接集合</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97869854">ARM+LINUX嵌入式学习路线 - 知乎 (zhihu.com)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.openedv.com/docs/book-videos/zdyzshipin/4free/zdyz-freertos-book.html">http://www.openedv.com/docs/book-videos/zdyzshipin/4free/zdyz-freertos-book.html</a></p>
</li>
</ul>
<h2 id="为什么选择FreeRtos"><a href="#为什么选择FreeRtos" class="headerlink" title="为什么选择FreeRtos?"></a>为什么选择FreeRtos?</h2><ul>
<li><p>RTOS 类系统有很多，比如 uC/OS，资料很多，尤其是中文资料，那为什么要选择 FreeRTOS 呢？</p>
</li>
<li><p>FreeRTOS是免费的，学习RTOS操作系统的话 uC/OS是首选，但要做产品的话，免费的FreeRTOS操作系统就是个不错的选择。</p>
</li>
<li><p>许多半导体厂商产品的 SDK(Software Development Kit—软件开发工具包) 包就使用 FreeRTOS 作为其操作系统，尤其是 WIFI、蓝牙这些带协议栈的芯片或模块。</p>
</li>
<li><p>简单，因为FreeRTOS 的文件数量很少。</p>
</li>
</ul>
<h2 id="FreeRtos-特点"><a href="#FreeRtos-特点" class="headerlink" title="FreeRtos 特点"></a>FreeRtos 特点</h2><ul>
<li>FreeRTOS 的内核支持抢占式，合作式和时间片调度。</li>
<li>提供了一个用于低功耗的 Tickless 模式。</li>
<li>系统的组件在创建时可以选择动态或者静态的 RAM，比如任务、消息队列、信号量、软件定时器等等。</li>
<li>FreeRTOS-MPU 支持 Corex-M 系列中的 MPU 单元，如 STM32F429。</li>
<li>FreeRTOS 系统简单、小巧、易用，通常情况下内核占用 4k-9k 字节的空间。</li>
<li>高可移植性，代码主要 C 语言编写。</li>
<li>高效的软件定时器。</li>
<li>强大的跟踪执行功能。</li>
<li>堆栈溢出检测功能。</li>
<li>任务数量不限。</li>
<li>任务优先级不限。</li>
</ul>
<p><strong>官网：</strong><a target="_blank" rel="noopener" href="http://www.freertos.org/">www.freertos.org</a></p>
<h2 id="基于STM32F407和Cubemx（HAL库）的FreeRtos开发"><a href="#基于STM32F407和Cubemx（HAL库）的FreeRtos开发" class="headerlink" title="基于STM32F407和Cubemx（HAL库）的FreeRtos开发"></a>基于STM32F407和Cubemx（HAL库）的FreeRtos开发</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90608412">FreeRTOS 从入门到精通1–实时操作系统的前世今生 - 知乎 (zhihu.com)</a></p>
</li>
<li><p>为什么选用HAl库？因为ST官方 <strong><u>已经停止</u></strong> 对于标准库的维护</p>
</li>
<li><p>使用STM32CubeIDE的（ <strong>未尝试盗版仿真器能不能使用</strong> ）</p>
</li>
</ul>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-pytorch入门笔记"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/08/pytorch%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/"
    >pytorch入门笔记</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/08/pytorch%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2021-12-08T13:59:11.000Z" itemprop="datePublished">2021-12-08</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="pytorch入门笔记及资源集合"><a href="#pytorch入门笔记及资源集合" class="headerlink" title="pytorch入门笔记及资源集合"></a>pytorch入门笔记及资源集合</h1><h2 id="教程手册"><a href="#教程手册" class="headerlink" title="教程手册"></a>教程手册</h2><p>莫烦 <a target="_blank" rel="noopener" href="https://mofanpy.com/tutorials/machine-learning/reinforcement-learning/">https://mofanpy.com/tutorials/machine-learning/reinforcement-learning/</a></p>
<p>pytorch中文手册</p>
<p><a target="_blank" rel="noopener" href="https://handbook.pytorch.wiki/">https://handbook.pytorch.wiki/</a></p>
<h2 id="转移到GPU上训练"><a href="#转移到GPU上训练" class="headerlink" title="转移到GPU上训练"></a>转移到GPU上训练</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41012765/article/details/128089337">参考</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45354497/article/details/130346967">参考2</a></li>
<li>主要操作是判断系统是否支持GPU训练并且指定设备<code>device</code><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">device = torch.device(<span class="string">&quot;cuda:0&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>) <span class="comment"># 设置使用GPU计算</span></span><br></pre></td></tr></table></figure></li>
<li>对创建的模型执行<code>module.to(device)</code></li>
<li>对创建的<code>torch.tensor()</code>也执行<code>.to(device)</code></li>
<li>注意，CPU上的参数只能和CPU上的参数互相运算，GPU上的参数只能和GPU上的参数互相计算，不能混杂，<u>混杂的时候需要都迁移到GPU上计算或者都迁移到CPU上计算</u></li>
<li>假如网络已经迁移到了GPU上，那么网络的输入参数也需要是GPU上的Tensor，输出也是GPU的</li>
</ul>
<h2 id="detach函数"><a href="#detach函数" class="headerlink" title="detach函数"></a>detach函数</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31244453/article/details/112473947">https://blog.csdn.net/qq_31244453/article/details/112473947</a></p>
<p>返回一个新的tensor，从当前计算图中分离下来。但是仍指向原变量的存放位置，不同之处只是requirse_grad为false.得到的这个tensir永远不需要计算器梯度，不具有grad.</p>
<h2 id="某博主的DDPG"><a href="#某博主的DDPG" class="headerlink" title="某博主的DDPG"></a>某博主的DDPG</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/blanokvaffy/article/details/86232658">https://blog.csdn.net/blanokvaffy/article/details/86232658</a></p>
<h2 id="网络保存与加载"><a href="#网络保存与加载" class="headerlink" title="网络保存与加载"></a>网络保存与加载</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41680653/article/details/93768559">https://blog.csdn.net/weixin_41680653/article/details/93768559</a></p>
<h2 id="torch-mean"><a href="#torch-mean" class="headerlink" title="torch.mean()"></a>torch.mean()</h2><p> mean()函数的参数：dim=0,按行求平均值，返回的形状是（1，列数）；dim=1,按列求平均值，返回的形状是（行数，1）,默认不设置dim的时候，返回的是所有元素的平均值。</p>
<h2 id="torch的zero-grad-函数"><a href="#torch的zero-grad-函数" class="headerlink" title="torch的zero_grad()函数"></a>torch的zero_grad()函数</h2><p>调用backward()函数之前都要将梯度清零，因为如果梯度不清零，pytorch中会将上次计算的梯度和本次计算的梯度累加</p>
<h2 id="torch-tensor的view函数"><a href="#torch-tensor的view函数" class="headerlink" title="torch tensor的view函数"></a>torch tensor的view函数</h2><p>view(*args) → Tensor<br>返回一个有相同数据但大小不同的tensor。 返回的tensor必须有与原tensor相同的数据和相同数目的元素，但可以有不同的大小。</p>
<p>参数是-1的时候这个维度的长度从其他维度<strong>推算</strong></p>
<h2 id="torch-tensor的-sequeeze和unsqueeze"><a href="#torch-tensor的-sequeeze和unsqueeze" class="headerlink" title="torch tensor的 sequeeze和unsqueeze"></a>torch tensor的 sequeeze和unsqueeze</h2><p>squeeze()：</p>
<p><code>squeeze(arg)</code>表示第arg维的维度值为1，则去掉该维度。否则tensor不变。（即若<code>tensor.shape()[arg] = 1</code>，则去掉该维度）</p>
<p>unsqueeze()：</p>
<p><code>unsqueeze(arg)</code>与<code>squeeze(arg)</code>作用相反，表示在第arg维增加一个维度值为1的维度。</p>
<h2 id="matplotlib画图的时候出现横坐标标签重叠的问题"><a href="#matplotlib画图的时候出现横坐标标签重叠的问题" class="headerlink" title="matplotlib画图的时候出现横坐标标签重叠的问题"></a>matplotlib画图的时候出现横坐标标签重叠的问题</h2><ul>
<li><p>比如<img src="/imgs/50c9faa8d6b6a76f26b9902c7a998ab59938bdfaf1117a6f3f81dc5b4a14700f.png" alt="picture 1">  </p>
</li>
<li><p>只需要在代码中加入<code>plt.tight_layout()</code>即可（在<code>plt.show()</code>之前）</p>
</li>
<li><p><img src="/imgs/cf4cc41c2b34494854a1c3662a1e16238ec21a10dd3d151b245477088b950a57.png" alt="picture 2">  </p>
<h2 id="matplotlib添加希腊字母的latex方法"><a href="#matplotlib添加希腊字母的latex方法" class="headerlink" title="matplotlib添加希腊字母的latex方法"></a>matplotlib添加希腊字母的latex方法</h2></li>
<li><p><code>plt.ylabel(&quot;cos(&quot;+r&#39;$\theta$&#39;+&quot;)&quot;)</code>，希腊字母用<code>r&#39;$\希腊字母$&#39;</code>即可</p>
</li>
<li><p>效果：<img src="/imgs/c0577006ba23e2df4a37e467756a55f016f0b2143078650c0daed7e891dba90f.png" alt="picture 3">  </p>
</li>
</ul>
<h2 id="将gym的输出保存为gif动画"><a href="#将gym的输出保存为gif动画" class="headerlink" title="将gym的输出保存为gif动画"></a>将gym的输出保存为gif动画</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveAsGIF</span>(<span class="params">frames</span>):</span></span><br><span class="line">    patch = plt.imshow(frames[<span class="number">0</span>])</span><br><span class="line">    plt.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">animate</span>(<span class="params">i</span>):</span></span><br><span class="line">        patch.set_data(frames[i])</span><br><span class="line"></span><br><span class="line">    anim = animation.FuncAnimation(plt.gcf(), animate, frames=<span class="built_in">len</span>(frames), interval=<span class="number">5</span>)</span><br><span class="line">    anim.save(<span class="string">&quot;./CartPole_v1_result.gif&quot;</span>, writer=<span class="string">&quot;pillow&quot;</span>, fps=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>此外，还需要在创建gym环境的时候进行一些操作（<strong>此处新版的gym和旧版的不太相同</strong>）<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">env = gym.make(<span class="string">&#x27;Pendulum-v1&#x27;</span>, render_mode=<span class="string">&quot;rgb_array&quot;</span>)</span><br><span class="line">frames = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    frames.append(env.render())</span><br></pre></td></tr></table></figure></li>
<li>然后再将<code>frames</code>当作参数传入前面的函数<code>saveAsGIF()</code>中</li>
<li><img src="/imgs/4b4706ade3cd854f191da16b2a009e2f3be50d13fc63410581fece37afe1d1f5.gif" alt="picture 5">  <h2 id="python中的"><a href="#python中的" class="headerlink" title="python中的@"></a>python中的<code>@</code></h2></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/daniumiqi/p/12162192.html">参考链接</a><h2 id="python中的None"><a href="#python中的None" class="headerlink" title="python中的None"></a>python中的<code>None</code></h2></li>
<li><a target="_blank" rel="noopener" href="https://m.php.cn/article/419082.html">参考链接</a><ul>
<li>就是空对象，无类型<h2 id="各种激活函数"><a href="#各种激活函数" class="headerlink" title="各种激活函数"></a>各种激活函数</h2></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53675977/article/details/128262957">激活函数</a></li>
<li>其他的激活函数（比如<code>Leaky ReLU</code>）<ul>
<li><img src="/imgs/4c60e86b0de8c2dbf449552f23d0b4e870f769bf39de1271825167ced38fc4e5.png" alt="picture 1">  <h2 id="梯度消失问题"><a href="#梯度消失问题" class="headerlink" title="梯度消失问题"></a>梯度消失问题</h2></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3f35e555d5ba">参考链接1</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/268007336">参考链接2</a></li>
<li>简而言之就是比如使用<code>sigmoid</code>函数作为激活函数，因为<code>sigmoid</code>函数的梯度小于1，导致随着反向传播的层数加深，往前的层因为连乘的<code>sigmoid</code>函数导数次数过多，使得<strong>梯度越来越小</strong>，实际上<u>起不到任何的训练效果</u>，网络实际有效的<strong>只有靠后的几层</strong>。</li>
<li>也有其他方法来解决梯度消失的问题，比如ResNET等等<h2 id="Jetson开发板上找不到libomp-so文件的解决办法"><a href="#Jetson开发板上找不到libomp-so文件的解决办法" class="headerlink" title="Jetson开发板上找不到libomp.so文件的解决办法"></a>Jetson开发板上找不到<code>libomp.so</code>文件的解决办法</h2></li>
<li>在Jetson开发板上安装<code>pytorch</code>之后，<code>import pytorch</code>的时候报错找不到<code>libomp.so</code>文件<ul>
<li><img src="/imgs/e317ba90bc5aa315f81b9f9c7f8348c74ca3f4eef31244c81dfbbe3a3d90738f.png" alt="picture 2">  </li>
</ul>
</li>
<li>但是同样的代码在命令行手动使用<code>python3 &lt;文件名&gt;</code>就<strong>可以执行</strong></li>
<li>此时可以通过安装<code>sudo apt-get install libomp5 libomp-dev</code>解决，<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/632057827">参考</a><h2 id="python实现命令行进度条"><a href="#python实现命令行进度条" class="headerlink" title="python实现命令行进度条"></a>python实现命令行进度条</h2></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/390722326">参考</a><h2 id="python从图片生成gif"><a href="#python从图片生成gif" class="headerlink" title="python从图片生成gif"></a>python从图片生成gif</h2></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/634922656">参考</a></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-TD3网络"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/08/TD3%E7%BD%91%E7%BB%9C/"
    >TD3网络</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/08/TD3%E7%BD%91%E7%BB%9C/" class="article-date">
  <time datetime="2021-12-08T13:31:09.000Z" itemprop="datePublished">2021-12-08</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="TD3网络"><a href="#TD3网络" class="headerlink" title="TD3网络"></a>TD3网络</h1><ul>
<li><p>TD3是<strong>Twin Delayed</strong> Deep Deterministic policy gradient algorithm的简称，<strong>双延迟</strong>深度确定性策略梯度</p>
<p>传统的DDPG：</p>
<p><img src="/imgs/image-20211208213332139.png" alt="image-20211208213332139"></p>
</li>
</ul>
<p>关注上图中，我们通过Critic网络估算动作的A值。一个Critic的评估可能会较高。所以我们加一个。</p>
<p><img src="/imgs/image-20211208213403185.png" alt="image-20211208213403185"></p>
<p>这就相当于我们把途中的Critic的框框，一个变为两个。</p>
<p>在目标网络中，我们估算出来的Q值会用min()函数求出较少值。以这个值作为更新的目标。</p>
<p>这个目标会更新两个网络 Critic网络_1 和 Critic网络_2。</p>
<p>你可以理解为这两个网络是完全独立，他们只是都用同一个目标进行更新。</p>
<p>剩余的就和DDPG一样了。过一段时间，把学习好的网络赋值给目标网络。</p>
<p>我们再仔细分别看Critic部分和Actor部分的学习。</p>
<h2 id="Critic部分的学习"><a href="#Critic部分的学习" class="headerlink" title="Critic部分的学习"></a>Critic部分的学习</h2><p>只有我们在计算Critic的更新目标时，我们才用target network。其中就包括了一个Policy network，用于计算A’；两个Q network ,用于计算两个Q值：Q1(A’) 和Q2(A’)。</p>
<p>Q1(A’) 和Q2(A’) 取最小值 min(Q1,Q2) 将代替DDPG的 Q(a’) 计算更新目标，也就是说： target = min(Q1,Q2) * gamma + r</p>
<p>target 将会是 Q_network_1 和 Q_network_2 两个网络的更新目标。</p>
<p>这里可能会有同学问，既然更新目标是一样的，那么为什么还需要两个网络呢?</p>
<p>虽然更新目标一样，两个网络会越来越趋近与和实际q值相同。但由于网络参数的初始值不一样，会导致计算出来的值有所不同。所以我们可以有空间选择较小的值去估算q值，避免q值被高估。</p>
<h2 id="Actor部分的学习"><a href="#Actor部分的学习" class="headerlink" title="Actor部分的学习"></a>Actor部分的学习</h2><p>我们在DDPG中说过，DDPG网络图像上就可以想象成一张布，覆盖在qtable上。当我们输入某个状态的时候，相当于这块布上的一个截面，我们我们能够看到在这个状态下的一条曲线。</p>
<p>而actor的任务，就是用梯度上升的方法，寻着这条线的最高点。</p>
<p>对于actor来说，其实并不在乎Q值是否会被高估，他的任务只是不断做梯度上升，寻找这条最大的Q值。随着更新的进行Q1和Q2两个网络，将会变得越来越像。所以用Q1还是Q2，还是两者都用，对于actor的问题不大。</p>
<h2 id="Delayed-延迟"><a href="#Delayed-延迟" class="headerlink" title="Delayed - 延迟"></a>Delayed - 延迟</h2><p>这里说的Dalayed ，是actor更新的delay。也就是说相对于critic可以更新多次后，actor再进行更新。</p>
<p>为什么要这样做呢？</p>
<p>还是回到我们qnet拟合出来的那块”布”上。</p>
<p>qnet在学习过程中，我们的q值是不断变化的，也就是说这块布是不断变形的。所以要寻着最高点的任务有时候就挺难为为的actor了。</p>
<p>可以想象，本来是最高点的，当actor好不容易去到最高点；q值更新了，这并不是最高点。这时候actor只能转头再继续寻找新的最高点。更坏的情况可能是actor被困在次高点，没有找到正确的最高点。</p>
<p>所以我们可以把Critic的更新频率，调的比Actor要高一点。让critic更加确定，actor再行动。</p>
<h2 id="target-policy-smoothing-regularization"><a href="#target-policy-smoothing-regularization" class="headerlink" title="target policy smoothing regularization"></a>target policy smoothing regularization</h2><p>TD3中，价值函数的更新目标每次都在action上加一个小扰动，这个操作就是target policy smoothing regularization</p>
<p>为什么要这样呢？</p>
<p>我们可以再次回到我们关于“布”的想象。</p>
<p>在DDPG中，计算target的时候，我们输入时s_和a_，获得q，也就是这块布上的一点A。通过估算target估算另外一点s，a，也就是布上的另外一点B的Q值。<br><img src="/imgs/image-20211208213605697.png" alt="image-20211208213605697"></p>
<p>在TD3中，计算target时候，输入s_到actor输出a后，给a加上噪音，让a在一定范围内随机。这又什么好处呢。</p>
<p>好处就是，当更新多次的时候，就相当于用A点附近的一小部分范围（准确来说是在s_这条线上的一定范围）的去估算B，这样可以让B点的估计更准确，更健壮。</p>
<p><img src="/imgs/image-20211208213632464.png" alt="image-20211208213632464"></p>
<ul>
<li>这注意区分三个地方：</li>
</ul>
<p>​    在跑游戏的时候，我们同样加上了了noise。这个时候的noise是为了更充分地开发整个游戏空间。<br>​    计算target的时候，actor加上noise，是为了预估更准确，网络更有健壮性。<br>​    更新actor的时候，我们不需要加上noise，这里是希望actor能够寻着最大值。加上noise并没有任何意义。</p>
<h2 id="下面附上源代码"><a href="#下面附上源代码" class="headerlink" title="下面附上源代码"></a>下面附上源代码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;迁移到了GPU上进行训练&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Actor</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, input_size, hidden_size, output_size</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Actor, self).__init__()</span><br><span class="line">        self.linear1 = nn.Linear(input_size, hidden_size)</span><br><span class="line">        self.linear2 = nn.Linear(hidden_size, hidden_size)</span><br><span class="line">        self.linear3 = nn.Linear(hidden_size, hidden_size)</span><br><span class="line">        self.linear4 = nn.Linear(hidden_size, output_size)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, s</span>):</span></span><br><span class="line">        x = F.relu(self.linear1(s))</span><br><span class="line">        x = F.relu(self.linear2(x))</span><br><span class="line">        x = F.relu(self.linear3(x))</span><br><span class="line">        x = torch.tanh(self.linear4(x))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Critic</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, input_size, hidden_size, output_size</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.linear1 = nn.Linear(input_size, hidden_size)</span><br><span class="line">        self.linear2 = nn.Linear(hidden_size, hidden_size)</span><br><span class="line">        self.linear3 = nn.Linear(hidden_size, hidden_size)</span><br><span class="line">        self.linear4 = nn.Linear(hidden_size, output_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, s, a</span>):</span></span><br><span class="line">        x = torch.cat([s, a], <span class="number">1</span>)</span><br><span class="line">        x = F.relu(self.linear1(x))</span><br><span class="line">        x = F.relu(self.linear2(x))</span><br><span class="line">        x = F.relu(self.linear3(x))</span><br><span class="line">        x = self.linear4(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            <span class="built_in">setattr</span>(self, key, value)</span><br><span class="line"></span><br><span class="line">        s_dim = self.env.observation_space.shape[<span class="number">0</span>]</span><br><span class="line">        a_dim = self.env.action_space.shape[<span class="number">0</span>]</span><br><span class="line">        fileList = os.listdir(<span class="string">&#x27;nets/&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;actor.pkl&quot;</span> <span class="keyword">in</span> fileList :</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Trained nets found!&quot;</span>)</span><br><span class="line"></span><br><span class="line">            self.actor = torch.load(<span class="string">&#x27;nets/actor.pkl&#x27;</span>)</span><br><span class="line">            self.actor_target = torch.load(<span class="string">&#x27;nets/actor_target.pkl&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            self.critic1 = torch.load(<span class="string">&#x27;nets/critic1.pkl&#x27;</span>)</span><br><span class="line">            self.critic_target1 = torch.load(<span class="string">&#x27;nets/critic_target1.pkl&#x27;</span>)</span><br><span class="line">            self.critic2 = torch.load(<span class="string">&#x27;nets/critic2.pkl&#x27;</span>)</span><br><span class="line">            self.critic_target2 = torch.load(<span class="string">&#x27;nets/critic_target2.pkl&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Trained nets not found!&quot;</span>)</span><br><span class="line"></span><br><span class="line">            self.actor = Actor(s_dim, <span class="number">256</span>, a_dim).cuda()</span><br><span class="line">            self.actor_target = Actor(s_dim, <span class="number">256</span>, a_dim).cuda()</span><br><span class="line"></span><br><span class="line">            self.critic1 = Critic(s_dim + a_dim, <span class="number">256</span>, <span class="number">1</span>).cuda()   <span class="comment"># 此处修改了critic的输出维度恒为1</span></span><br><span class="line">            self.critic_target1 = Critic(s_dim + a_dim, <span class="number">256</span>, <span class="number">1</span>).cuda()  <span class="comment"># 此处修改了critic的输出维度恒为1</span></span><br><span class="line">            self.critic2 = Critic(s_dim + a_dim, <span class="number">256</span>, <span class="number">1</span>).cuda()  <span class="comment"># 此处修改了critic的输出维度恒为1</span></span><br><span class="line">            self.critic_target2 = Critic(s_dim + a_dim, <span class="number">256</span>, <span class="number">1</span>).cuda()  <span class="comment"># 此处修改了critic的输出维度恒为1</span></span><br><span class="line">            <span class="comment"># 假如没找到存在的网络的话，初始化target网络</span></span><br><span class="line">            self.actor_target.load_state_dict(self.actor.state_dict())</span><br><span class="line"></span><br><span class="line">            self.critic_target1.load_state_dict(self.critic1.state_dict())</span><br><span class="line">            self.critic_target2.load_state_dict(self.critic2.state_dict())</span><br><span class="line"></span><br><span class="line">        self.actor_optim = optim.Adam(self.actor.parameters(), lr=self.actor_lr)</span><br><span class="line">        self.critic_optim1 = optim.Adam(self.critic1.parameters(), lr=self.critic_lr)</span><br><span class="line">        self.critic_optim2 = optim.Adam(self.critic2.parameters(), lr=self.critic_lr)</span><br><span class="line">        self.buffer = []</span><br><span class="line">        self.updateCnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">act</span>(<span class="params">self, s0</span>):</span></span><br><span class="line">        s0 = torch.tensor(s0, dtype=torch.<span class="built_in">float</span>).cuda().unsqueeze(<span class="number">0</span>).cuda()</span><br><span class="line">        a0 = self.actor(s0).squeeze(<span class="number">0</span>).detach().cpu().numpy()</span><br><span class="line">        <span class="keyword">return</span> a0</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, *transition</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.buffer) == self.capacity:</span><br><span class="line">            self.buffer.pop(<span class="number">0</span>)</span><br><span class="line">        self.buffer.append(transition)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">learn</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.buffer) &lt; self.batch_size:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        samples = random.sample(self.buffer, self.batch_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        s0, a0, r1, s1 = <span class="built_in">zip</span>(*samples)</span><br><span class="line"></span><br><span class="line">        s0 = torch.tensor(s0, dtype=torch.<span class="built_in">float</span>).cuda()</span><br><span class="line">        a0 = torch.tensor(a0, dtype=torch.<span class="built_in">float</span>).cuda()</span><br><span class="line">        r1 = torch.tensor(r1, dtype=torch.<span class="built_in">float</span>).view(self.batch_size, -<span class="number">1</span>).cuda()</span><br><span class="line">        s1 = torch.tensor(s1, dtype=torch.<span class="built_in">float</span>).cuda()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">critic_learn</span>():</span></span><br><span class="line">            a1 = self.actor_target(s1).detach()</span><br><span class="line">            y_true = r1 + self.gamma * torch.<span class="built_in">min</span>(self.critic_target1(s1, a1), self.critic_target1(s1, a1)).detach()</span><br><span class="line">            <span class="comment"># 更新网咯1</span></span><br><span class="line">            y_pred1 = self.critic1(s0, a0)</span><br><span class="line">            loss_fn = nn.MSELoss()</span><br><span class="line">            loss = loss_fn(y_pred1, y_true)</span><br><span class="line">            self.critic_optim1.zero_grad()</span><br><span class="line">            loss.backward()</span><br><span class="line">            self.critic_optim1.step()</span><br><span class="line">            <span class="comment"># 更新网络2</span></span><br><span class="line">            y_pred2 = self.critic2(s0, a0)</span><br><span class="line">            loss_fn = nn.MSELoss()</span><br><span class="line">            loss = loss_fn(y_pred2, y_true)</span><br><span class="line">            self.critic_optim2.zero_grad()</span><br><span class="line">            loss.backward()</span><br><span class="line">            self.critic_optim2.step()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">actor_learn</span>():</span></span><br><span class="line">            <span class="comment"># 此处update actor网络同样从两个critic网络中选择一个较小的</span></span><br><span class="line">            loss = -torch.mean(torch.<span class="built_in">min</span>(self.critic1(s0, self.actor(s0)), self.critic2(s0, self.actor(s0))))</span><br><span class="line">            self.actor_optim.zero_grad()</span><br><span class="line">            loss.backward()</span><br><span class="line">            self.actor_optim.step()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">soft_update</span>(<span class="params">net_target, net, tau</span>):</span></span><br><span class="line">            <span class="keyword">for</span> target_param, param <span class="keyword">in</span> <span class="built_in">zip</span>(net_target.parameters(), net.parameters()):</span><br><span class="line">                target_param.data.copy_(target_param.data * (<span class="number">1.0</span> - tau) + param.data * tau)</span><br><span class="line"></span><br><span class="line">        critic_learn()</span><br><span class="line">        soft_update(self.critic_target1, self.critic1, self.tau)</span><br><span class="line">        soft_update(self.critic_target2, self.critic2, self.tau)</span><br><span class="line">        self.updateCnt += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 到达更新频率的时候才更新actor</span></span><br><span class="line">        <span class="keyword">if</span>((self.updateCnt % self.update_interval) == <span class="number">0</span>):</span><br><span class="line">            actor_learn()</span><br><span class="line">            soft_update(self.actor_target, self.actor, self.tau)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">self</span>):</span></span><br><span class="line">        torch.save(self.actor, <span class="string">&#x27;nets/actor.pkl&#x27;</span>)</span><br><span class="line">        torch.save(self.actor_target, <span class="string">&#x27;nets/actor_target.pkl&#x27;</span>)</span><br><span class="line">        torch.save(self.critic1, <span class="string">&#x27;nets/critic1.pkl&#x27;</span>)</span><br><span class="line">        torch.save(self.critic_target1, <span class="string">&#x27;nets/critic_target1.pkl&#x27;</span>)</span><br><span class="line">        torch.save(self.critic2, <span class="string">&#x27;nets/critic2.pkl&#x27;</span>)</span><br><span class="line">        torch.save(self.critic_target2, <span class="string">&#x27;nets/critic_target2.pkl&#x27;</span>)</span><br><span class="line"></span><br><span class="line">env = gym.make(<span class="string">&#x27;Pendulum-v1&#x27;</span>)</span><br><span class="line">env.reset()</span><br><span class="line">env.render()</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&#x27;env&#x27;</span>: env,</span><br><span class="line">    <span class="string">&#x27;gamma&#x27;</span>: <span class="number">0.99</span>,</span><br><span class="line">    <span class="string">&#x27;actor_lr&#x27;</span>: <span class="number">0.001</span>,</span><br><span class="line">    <span class="string">&#x27;critic_lr&#x27;</span>: <span class="number">0.0013</span>,</span><br><span class="line">    <span class="string">&#x27;tau&#x27;</span>: <span class="number">0.02</span>,</span><br><span class="line">    <span class="string">&#x27;capacity&#x27;</span>: <span class="number">5000</span>,</span><br><span class="line">    <span class="string">&#x27;batch_size&#x27;</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="string">&#x27;update_interval&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">&#125;</span><br><span class="line">EPOCH_NUM = <span class="number">200</span></span><br><span class="line">agent = Agent(**params)</span><br><span class="line">FLAG = <span class="literal">False</span></span><br><span class="line">rewardList = []</span><br><span class="line"><span class="comment"># INTCOEFF = 0.001</span></span><br><span class="line">integral = <span class="number">0</span></span><br><span class="line"><span class="comment"># INTCOEFF = 0.0</span></span><br><span class="line"><span class="keyword">for</span> episode <span class="keyword">in</span> <span class="built_in">range</span>(EPOCH_NUM):</span><br><span class="line">    s0 = env.reset()</span><br><span class="line">    episode_reward = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span>(episode%<span class="number">20</span> == <span class="number">0</span>):</span><br><span class="line">        flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">    integral = <span class="number">0</span></span><br><span class="line">    INTCOEFF = (episode/EPOCH_NUM)**<span class="number">2</span>*<span class="number">0.005</span></span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">if</span>(flag):</span><br><span class="line">            env.render()</span><br><span class="line">        a0 = agent.act(s0)</span><br><span class="line">        s1, r1, done, _ = env.step(a0)</span><br><span class="line">        integral += r1*INTCOEFF</span><br><span class="line">        agent.put(s0, a0, r1+integral, s1)</span><br><span class="line"></span><br><span class="line">        episode_reward += r1</span><br><span class="line">        s0 = s1</span><br><span class="line"></span><br><span class="line">        agent.learn()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(episode, <span class="string">&#x27;: &#x27;</span>, episode_reward)</span><br><span class="line">    rewardList.append(episode_reward)</span><br><span class="line">pltX = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(EPOCH_NUM)]</span><br><span class="line">plt.plot(pltX, rewardList)</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment"># agent.save()</span></span><br></pre></td></tr></table></figure>

<p>详见<a target="_blank" rel="noopener" href="https://gitee.com/frankzhang0219/ddpg_try">DDPG_Try: DDPG尝试集 (gitee.com)</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-安装NodeJS以及hexo"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/08/%E5%AE%89%E8%A3%85NodeJS%E4%BB%A5%E5%8F%8Ahexo/"
    >安装NodeJS以及hexo</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/08/%E5%AE%89%E8%A3%85NodeJS%E4%BB%A5%E5%8F%8Ahexo/" class="article-date">
  <time datetime="2021-12-08T13:00:13.000Z" itemprop="datePublished">2021-12-08</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="安装nodeJS以及hexo框架的踩坑笔记"><a href="#安装nodeJS以及hexo框架的踩坑笔记" class="headerlink" title="安装nodeJS以及hexo框架的踩坑笔记"></a>安装nodeJS以及hexo框架的踩坑笔记</h1><ul>
<li>版本问题：<br>一开始使用的是最新版本的NodeJS然后安装完成Hexo之后发现不能在控制台使用hexo init blog，显示hexo不是命令。<br>然后使用HodeJS12.0.0，自带npm，安装完成（注意不要使用13等版本，npm不是支持每个nodeJS版本）</li>
<li>假如直接<code>git clone</code>hexo的仓库报错的话可能是换设备之后 <strong>无法通用</strong> ，还是需要在 <strong>原设备</strong> 上才能打的开<img src="/imgs/image-20211214003223898.png" alt="image-20211214003223898"></li>
<li>假如重装hexo失败的话，删除图中文件夹下的hexo有关的所有内容<img src="/imgs/image-20211208201712068.png" alt="image-20211208201712068"></li>
<li>安装完成之后在控制台输入以下代码，假如没有报错而且能够正确显示版本号的话说明安装成功<br><code>node -v</code><code>npm -v</code></li>
</ul>
<ul>
<li>另注意，假如安装完nodeJS之后，输入<code>node -v</code>得到的版本和安装的 <strong>不同</strong> ，此时需要将NodeJS卸载然后安装在 <strong>默认的安装位置</strong> 。注意，AMD CPU的计算机下载x86的，Intel的下载x64的msi安装文件</li>
</ul>
<ul>
<li><p>插入图片问题<br>有时候插入的图片会加载失败比如显示为 <img src="/imgs/2.png" alt="2">，此时可以通过以下几步解决问题</p>
</li>
<li><p>首先，在source目录下新建一个文件夹比如imgs</p>
<p><img src="/imgs/image-20211208204226807.png" alt="image-20211208204226807"></p>
<p>然后把typora的根目录设置为source</p>
<p><img src="/imgs/image-20211208204322540.png" alt="image-20211208204322540"></p>
<p>然后设置将图片复制到imgs下</p>
<p><img src="/imgs/image-20211208204358165.png" alt="image-20211208204358165"></p>
<p>配置好上述功能之后，直接把用到的图片从剪贴板复制到typora即可</p>
<p><strong>不要安装</strong>网上博客说的插件，安装之后可能无法启动网站</p>
<p>也<strong>不需要</strong>在config中开启每新建一篇博客就新建一个文件夹之类的选项，反而更麻烦</p>
</li>
<li><p>修改主题<br>从github将主题项目 <code>git clone</code>到blogs的 <code>\themes\&lt;主题名称&gt;</code>文件夹，然后将总目录下的 <code>_config.yml</code>中的 <code>theme</code>更换为&lt;主题名称&gt;<br>假如无法clone的话，可以将项目打包下载然后解压到同样的文件夹中即可</p>
</li>
<li><p>设置个人信息如下图<br><img src="/imgs/3.png" alt="3"></p>
</li>
<li><p>此外，在主题的配置文件中（也是 <code>_config.yml</code>）也有一些可以修改的地方，可以自己动手改一改</p>
</li>
<li><p>在推送网站之前需要安装一个git配合插件<br><code>npm install hexo-deployer-git --save</code></p>
</li>
</ul>
<h2 id="更换设备"><a href="#更换设备" class="headerlink" title="更换设备"></a>更换设备</h2><ul>
<li>注意更换设备的时候<strong>不能</strong>简单的<code>git clone</code>，这样的话是无法打开的。只能自己在本地新建一个博客，然后将<code>source</code>和<code>themes</code>以及<code>config</code>文件和文件夹都 <strong>复制进去</strong></li>
</ul>
<h2 id="部署的地址"><a href="#部署的地址" class="headerlink" title="部署的地址"></a>部署的地址</h2><ul>
<li>部署的时候 <strong><u>不能使用</u></strong> 网页上的教程repo地址如图</li>
</ul>
<p><img src="/imgs/image-20211209101305939.png" alt="image-20211209101305939"></p>
<p>需要直接写成自己的<strong>仓库地址+.git</strong>，比如</p>
<p><img src="/imgs/image-20211209101336927.png" alt="image-20211209101336927"></p>
<ul>
<li>此外，相关的 <strong>url和root</strong> 配置如下;</li>
</ul>
<p><img src="/imgs/image-20211209101427432.png" alt="image-20211209101427432"></p>
<p>即可正常显示</p>
<h2 id="向服务器提交过程"><a href="#向服务器提交过程" class="headerlink" title="向服务器提交过程"></a>向服务器提交过程</h2><p><code>hexo clean</code></p>
<p><code>hexo g</code></p>
<p><code>hexo d</code></p>
<h2 id="详细入门网站"><a href="#详细入门网站" class="headerlink" title="详细入门网站"></a>详细入门网站</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26625249">https://zhuanlan.zhihu.com/p/26625249</a></p>
<h2 id="gitee网站教程"><a href="#gitee网站教程" class="headerlink" title="gitee网站教程"></a>gitee网站教程</h2><p><a target="_blank" rel="noopener" href="https://gitee.com/help/articles/4136#article-header0">https://gitee.com/help/articles/4136#article-header0</a></p>
<h2 id="vscode-markdown插件（相对方便，但是不支持图片复制，建议还是用typora）"><a href="#vscode-markdown插件（相对方便，但是不支持图片复制，建议还是用typora）" class="headerlink" title="vscode markdown插件（相对方便，但是不支持图片复制，建议还是用typora）"></a>vscode markdown插件（相对方便，但是不支持图片复制，建议还是用typora）</h2><p>office viewer</p>
<p><img src="/imgs/4.png" alt="4"></p>
<hr>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/15/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021-2024
        <i class="ri-heart-fill heart_icon"></i> FrankZhang
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/avatar.png" alt="Frank’s blogs"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>